---
created: 
creator: Benky
description: ''
title: 第五章 绘制蓝图
---
<div lang="en" id="content" dir="ltr"><span id="top" class="anchor"/>
<span id="line-1" class="anchor"/><p class="line867"/><div class="table-of-contents"><p class="table-of-contents-heading">目录</p><ol><li><a href="#head-476149c3af67c9ad7bc393412ff089d9734859d5">创建你的蓝图</a><ol><li><a href="#head-ccafb1a137076085306a44617cde958f277b1716">重构如何帮我改进我的代码？</a><ol><li><a href="#head-b718302d8b9783805cf877110180e77980931ca3">一个重构的例子</a></li><li><a href="#head-e079ce7b0227a1554c04609a0f21eb0d4978b172">开始重构</a></li><li><a href="#head-6f348cd094a4cf060d7547d791a17ffd7d5613b2">进一步重构</a></li></ol></li><li><a href="#head-04a6951c1b341d13ec7b71bc0dc78fa16b4c4657">如何保持模型(Model)与视图(View)分离？</a><ol><li><a href="#head-3a64788772284f7f47f007ac1de04115b65f31b5">MVC(Model-View-Controller)系统是什么？</a></li><li><a
href="#head-621ac42f84c3562634ee4248ba91e0a180beba2f">一个wxPython模型：PyGridTableBase</a></li><li><a href="#head-a6da2733890a701b0c0bf336863a86cb9c72c28e">自定义模型</a></li></ol></li><li><a href="#head-594c3400ef2de24c1b92f431d71fec45b2b196a8">如何对一个GUI程序进行单元测试？</a><ol><li><a href="#head-8c0e644016692f5a9c2d62b234f89f44b7d9d66e">unittest模块</a></li><li><a href="#head-9864f0790accbfd523b31c462c230146512f020f">一个unittest范例</a></li><li><a href="#head-23e13dd0eae64e87845ec9c55b10c3a5c2369726">测试用户事件</a></li></ol></li><li><a href="#head-fef54ea4ec3bb8cc7561153dc840d2dcc54e588a">本章小结</a></li></ol></li></ol></div> <span id="line-2" class="anchor"/>
<h1 id="head-476149c3af67c9ad7bc393412ff089d9734859d5">1. 创建你的蓝图</h1>
<span id="line-3" class="anchor"/><span id="line-4" class="anchor"/><p class="line862">众所周知，<tt>GUI</tt>代码是难于阅读和维护的，并且看上去总是一塌糊涂。本章我们将讨论三个驯服你的<tt>UI</tt>代码的技术。我们将讨论重构代码以使其易于阅读、管理和维护。另一个方面是显示代码和基本的处理对象之间的处理，这也是<tt>UI</tt>程序员头痛的地方。<tt>MVC</tt>（<tt>Model</tt>/<tt>View</tt>/<tt>Controller</tt>）设计模式是这样一种结构，它保持显示和数据分离以便各自的改变相互不影响。最后，我们讨论对你的<tt>wxPython</tt>代码进行单元测试的技术。尽管本章的所有例子将使用<tt>wxPython</tt>，但是其中的多数原则是可以应用到任何<tt>UI</tt>工具的，代码的设计和体系结构就是所谓的蓝图。一个深思熟虑的蓝图将使得你的应用程序建造起来更简单和更易维护。本章的建议将帮助你为你的程序设计一个可靠的蓝图。 <span
id="line-5" class="anchor"/><span id="line-6" class="anchor"/><span id="line-7" class="anchor"/></p><p class="line867">
</p><h2 id="head-ccafb1a137076085306a44617cde958f277b1716">1.1. 重构如何帮我改进我的代码？</h2>
<span id="line-8" class="anchor"/><span id="line-9" class="anchor"/><span id="line-10" class="anchor"/><p class="line874">好的程序员为什么也会写出不好的界面或界面代码？这有很多原因。甚至一个简单的用户界面可能都要求很多行来显示屏幕上的所有元素。程序员通常试图用单一的方法来实现这些，这种方法迅速变得长且难于控制。此外界面代码是很容易受到不断改变的影响的，除非你对管理这些改变训练有素。由于写界面代码可能是很枯燥的，所以界面程序员经常会使用设计工具来生成代码。机器生成的代码相对于手工代码来说是很差。 <span id="line-11" class="anchor"/><span id="line-12" class="anchor"/></p><p
class="line862">原则上讲，保持<tt>UI</tt>代码在控制之下是不难的。关键是重构或不断改进现有代码的设计和结构。重构的目的是保持代码在以后易读和易于维护。下表5.1说明了在重构时需要记住的一些原则。最重要的是要记住，某人以后可能会不得不读和理解你的代码。努力让他人的生活更容易些，毕竟那有可能是你。 <span id="line-13" class="anchor"/><span id="line-14" class="anchor"/><span id="line-15" class="anchor"/></p><p class="line867"><strong>表5.1</strong> <span id="line-16" class="anchor"/><strong>重构的一些重要原则</strong> <span id="line-17" class="anchor"/><span id="line-18" class="anchor"/></p><p class="line874">不要重复：你应该避免有多个相同功能的段。当这个功能需要改变时，这维护起来会很头痛。 <span id="line-19"
class="anchor"/>一次做一件事情：一个方法应该并且只做一件事情。各自的事件应该在各自的方法中。方法应该保持短小。 <span id="line-20" class="anchor"/>嵌套的层数要少：尽量使嵌套代码不多于2或3层。对于一个单独的方法，深的嵌套也是一个好的选择。 <span id="line-21" class="anchor"/>避免字面意义上的字符串和数字：字面意义上的字符串和数字应使其出现在代码中的次数最小化。一个好的方法是，把它们从你的代码的主要部分中分离出来，并存储于一个列表或字典中。 <span id="line-22" class="anchor"/><span id="line-23" class="anchor"/></p><p
class="line862">这些原则在<tt>Python</tt>代码中特别重要。因为<tt>Python</tt>的缩进语法、小而简洁的方法是很容易去读的。然而，长的方法对于理解来说是更困难的，尤其是如果它们在一个屏幕上不能完全显示出来时。类似的，<tt>Python</tt>中的深的嵌套使得跟踪代码块的开始和结尾很棘手。然而，<tt>Python</tt>在避免重复方面是十分好的一种语言，特别是因为函数和方法或以作为参数传递。 <span id="line-24" class="anchor"/><span id="line-25" class="anchor"/><span id="line-26" class="anchor"/></p><p class="line867">
</p><h3 id="head-b718302d8b9783805cf877110180e77980931ca3">1.1.1. 一个重构的例子</h3>
<span id="line-27" class="anchor"/><span id="line-28" class="anchor"/><span id="line-29" class="anchor"/><p class="line862">为了展示给你如何在实际工作中应用这些原则，我们将看一个重构的例子。图5.1显示了一个窗口，它可用作访问微软<tt>Access</tt>类数据库的前端。 <span id="line-30" class="anchor"/><span id="line-31" class="anchor"/></p><p class="line874">图5.1 <span id="line-32" class="anchor"/><span id="line-33" class="anchor"/></p><p class="line867"><img title="attachment:w5.1.gif" src="/moin/WxPythonInAction/ChapterFive?action=AttachFile&amp;do=get&amp;target=w5.1.gif" class="attachment"/> <span id="line-34" class="anchor"/><span id="line-35" class="anchor"/><span id="line-36" class="anchor"/></p><p
class="line874">它的布置比之前我们的所见过的那些要复杂一些。但是按现实中的应用程序的标准，它仍然十分简单。例5.1的代码的结构很差。 <span id="line-37" class="anchor"/><span id="line-38" class="anchor"/><span id="line-39" class="anchor"/></p><p class="line867"><strong>例5.1</strong> <span id="line-40" class="anchor"/><strong>产生图5.1的没有重构的代码</strong> <span id="line-41" class="anchor"/><span id="line-42" class="anchor"/><span id="line-43" class="anchor"/><span id="line-44" class="anchor"/><span id="line-45" class="anchor"/><span id="line-46" class="anchor"/><span id="line-47" class="anchor"/><span id="line-48" class="anchor"/><span id="line-49" class="anchor"/><span id="line-50" class="anchor"/><span id="line-51" class="anchor"/><span id="line-52" class="anchor"/><span
id="line-53" class="anchor"/><span id="line-54" class="anchor"/><span id="line-55" class="anchor"/><span id="line-56" class="anchor"/><span id="line-57" class="anchor"/><span id="line-58" class="anchor"/><span id="line-59" class="anchor"/><span id="line-60" class="anchor"/><span id="line-61" class="anchor"/><span id="line-62" class="anchor"/><span id="line-63" class="anchor"/><span id="line-64" class="anchor"/><span id="line-65" class="anchor"/><span id="line-66" class="anchor"/><span id="line-67" class="anchor"/><span id="line-68" class="anchor"/><span id="line-69" class="anchor"/><span id="line-70" class="anchor"/><span id="line-71" class="anchor"/><span id="line-72" class="anchor"/><span id="line-73" class="anchor"/><span id="line-74" class="anchor"/><span id="line-75"
class="anchor"/><span id="line-76" class="anchor"/><span id="line-77" class="anchor"/><span id="line-78" class="anchor"/><span id="line-79" class="anchor"/><span id="line-80" class="anchor"/><span id="line-81" class="anchor"/><span id="line-82" class="anchor"/><span id="line-83" class="anchor"/><span id="line-84" class="anchor"/><span id="line-85" class="anchor"/><span id="line-86" class="anchor"/><span id="line-87" class="anchor"/><span id="line-88" class="anchor"/><span id="line-89" class="anchor"/><span id="line-90" class="anchor"/><span id="line-91" class="anchor"/><span id="line-92" class="anchor"/><span id="line-93" class="anchor"/><span id="line-94" class="anchor"/><span id="line-95" class="anchor"/><span id="line-96" class="anchor"/><span id="line-97"
class="anchor"/><span id="line-98" class="anchor"/><span id="line-99" class="anchor"/><span id="line-100" class="anchor"/><span id="line-101" class="anchor"/><span id="line-102" class="anchor"/><span id="line-103" class="anchor"/><span id="line-104" class="anchor"/><span id="line-105" class="anchor"/><span id="line-106" class="anchor"/><span id="line-107" class="anchor"/><span id="line-108" class="anchor"/><span id="line-109" class="anchor"/><span id="line-110" class="anchor"/><span id="line-111" class="anchor"/><span id="line-112" class="anchor"/><span id="line-113" class="anchor"/><span id="line-114" class="anchor"/><span id="line-115" class="anchor"/><span id="line-116" class="anchor"/><span id="line-117" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
function isnumbered(obj) {
return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
var nlen = Math.max(0,chrs-(''+num).length), res = '';
while (nlen>0) { res += ' '; nlen-- }
return res+num+add;
}
function addnumber(did, nstart, nstep) {
var c = document.getElementById(did), l = c.firstChild, n = 1;
if (!isnumbered(c))
if (typeof nstart == 'undefined') nstart = 1;
if (typeof nstep  == 'undefined') nstep = 1;
n = nstart;
while (l != null) {
if (l.tagName == 'SPAN') {
var s = document.createElement('SPAN');
s.className = 'LineNumber'
s.appendChild(document.createTextNode(nformat(n,4,' ')));
n += nstep;
if (l.childNodes.length)
l.insertBefore(s, l.firstChild)
else
l.appendChild(s)
}
l = l.nextSibling;
}
return false;
}
function remnumber(did) {
var c = document.getElementById(did), l = c.firstChild;
if (isnumbered(c))
while (l != null) {
if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
l = l.nextSibling;
}
return false;
}
function togglenumber(did, nstart, nstep) {
var c = document.getElementById(did);
if (isnumbered(c)) {
remnumber(did);
} else {
addnumber(did,nstart,nstep);
}
return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-8619dca591f1e1b0b755254901bd69715238ee72_000\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-8619dca591f1e1b0b755254901bd69715238ee72_000', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-8619dca591f1e1b0b755254901bd69715238ee72_000" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="Comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="Comment"/></span>
<span class="line"><span class="LineNumber">   3 </span><span class="ResWord">import</span> <span class="ID">wx</span></span>
<span class="line"><span class="LineNumber">   4 </span></span>
<span class="line"><span class="LineNumber">   5 </span><span class="ResWord">class</span> <span class="ID">RefactorExample</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   6 </span></span>
<span class="line"><span class="LineNumber">   7 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">id</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   8 </span>        <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">id</span><span class="Operator">,</span> <span class="String">'Refactor Example'</span><span class="Operator">,</span><span class="ID">size</span><span class="Operator">=</span><span class="Operator">(</span><span
class="Number">340</span><span class="Operator">,</span> <span class="Number">200</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ID">panel</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Panel</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  10 </span>        <span class="ID">panel</span><span class="Operator">.</span><span class="ID">SetBackgroundColour</span><span class="Operator">(</span><span class="String">"White"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  11 </span>        <span class="ID">prevButton</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"   PREV"</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">80</span><span
class="Operator">,</span> <span class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  12 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnPrev</span><span class="Operator">,</span> <span class="ID">prevButton</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  13 </span>        <span class="ID">nextButton</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"NEXT   "</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">160</span><span
class="Operator">,</span> <span class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  14 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnNext</span><span class="Operator">,</span> <span class="ID">nextButton</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  15 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_CLOSE</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnCloseWindow</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  16 </span></span>
<span class="line"><span class="LineNumber">  17 </span>        <span class="ID">menuBar</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">MenuBar</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  18 </span>        <span class="ID">menu1</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Menu</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  19 </span>        <span class="ID">openMenuItem</span> <span class="Operator">=</span> <span class="ID">menu1</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">" "</span><span class="Operator">,</span> <span class="String">"Copy in status bar"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  20 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_MENU</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnOpen</span><span class="Operator">,</span> <span class="ID">openMenuItem</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  21 </span>        <span class="ID">quitMenuItem</span> <span class="Operator">=</span> <span class="ID">menu1</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">" "</span><span class="Operator">,</span> <span class="String">"Quit"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  22 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_MENU</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnCloseWindow</span><span class="Operator">,</span> <span class="ID">quitMenuItem</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  23 </span>        <span class="ID">menuBar</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="ID">menu1</span><span class="Operator">,</span> <span class="String">" "</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  24 </span>        <span class="ID">menu2</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Menu</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  25 </span>        <span class="ID">copyItem</span> <span class="Operator">=</span> <span class="ID">menu2</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">" "</span><span class="Operator">,</span> <span class="String">"Copy"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  26 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_MENU</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnCopy</span><span class="Operator">,</span> <span class="ID">copyItem</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  27 </span>        <span class="ID">cutItem</span> <span class="Operator">=</span> <span class="ID">menu2</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"C "</span><span class="Operator">,</span> <span class="String">"Cut"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  28 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_MENU</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnCut</span><span class="Operator">,</span> <span class="ID">cutItem</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  29 </span>        <span class="ID">pasteItem</span> <span class="Operator">=</span> <span class="ID">menu2</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"Paste"</span><span class="Operator">,</span> <span class="String">"Paste"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  30 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_MENU</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnPaste</span><span class="Operator">,</span> <span class="ID">pasteItem</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  31 </span>        <span class="ID">menuBar</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="ID">menu2</span><span class="Operator">,</span> <span class="String">" "</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  32 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetMenuBar</span><span class="Operator">(</span><span class="ID">menuBar</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  33 </span></span>
<span class="line"><span class="LineNumber">  34 </span>        <span class="ID">static</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">StaticText</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">NewId</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">,</span> <span class="String">"First Name"</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  35 </span>                <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">10</span><span class="Operator">,</span> <span class="Number">50</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  36 </span>        <span class="ID">static</span><span class="Operator">.</span><span class="ID">SetBackgroundColour</span><span class="Operator">(</span><span class="String">"White"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  37 </span>        <span class="ID">text</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">TextCtrl</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">NewId</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">,</span> <span class="String">""</span><span class="Operator">,</span> <span class="ID">size</span><span
class="Operator">=</span><span class="Operator">(</span><span class="Number">100</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  38 </span>                <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">80</span><span class="Operator">,</span> <span class="Number">50</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  39 </span></span>
<span class="line"><span class="LineNumber">  40 </span>        <span class="ID">static2</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">StaticText</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">NewId</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">,</span> <span class="String">"Last Name"</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  41 </span>                <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">10</span><span class="Operator">,</span> <span class="Number">80</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  42 </span>        <span class="ID">static2</span><span class="Operator">.</span><span class="ID">SetBackgroundColour</span><span class="Operator">(</span><span class="String">"White"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  43 </span>        <span class="ID">text2</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">TextCtrl</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">NewId</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">,</span> <span class="String">""</span><span class="Operator">,</span> <span class="ID">size</span><span
class="Operator">=</span><span class="Operator">(</span><span class="Number">100</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  44 </span>                <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">80</span><span class="Operator">,</span> <span class="Number">80</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  45 </span></span>
<span class="line"><span class="LineNumber">  46 </span>        <span class="ID">firstButton</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"FIRST"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  47 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnFirst</span><span class="Operator">,</span> <span class="ID">firstButton</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  48 </span></span>
<span class="line"><span class="LineNumber">  49 </span>        <span class="ID">menu2</span><span class="Operator">.</span><span class="ID">AppendSeparator</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  50 </span>        <span class="ID">optItem</span> <span class="Operator">=</span> <span class="ID">menu2</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">" "</span><span class="Operator">,</span> <span class="String">"Display Options"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  51 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_MENU</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnOptions</span><span class="Operator">,</span> <span class="ID">optItem</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  52 </span></span>
<span class="line"><span class="LineNumber">  53 </span>        <span class="ID">lastButton</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"LAST"</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">240</span><span
class="Operator">,</span> <span class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  54 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnLast</span><span class="Operator">,</span> <span class="ID">lastButton</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  55 </span></span>
<span class="line"><span class="LineNumber">  56 </span></span>
<span class="line"><span class="LineNumber">  57 </span>    <span class="Comment"># Just grouping the empty event handlers together</span></span>
<span class="line"><span class="LineNumber">  58 </span><span class="Comment"/>    <span class="ResWord">def</span> <span class="ID">OnPrev</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  59 </span>    <span class="ResWord">def</span> <span class="ID">OnNext</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  60 </span>    <span class="ResWord">def</span> <span class="ID">OnLast</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  61 </span>    <span class="ResWord">def</span> <span class="ID">OnFirst</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  62 </span>    <span class="ResWord">def</span> <span class="ID">OnOpen</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  63 </span>    <span class="ResWord">def</span> <span class="ID">OnCopy</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  64 </span>    <span class="ResWord">def</span> <span class="ID">OnCut</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  65 </span>    <span class="ResWord">def</span> <span class="ID">OnPaste</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  66 </span>    <span class="ResWord">def</span> <span class="ID">OnOptions</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  67 </span></span>
<span class="line"><span class="LineNumber">  68 </span>    <span class="ResWord">def</span> <span class="ID">OnCloseWindow</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  69 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Destroy</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  70 </span></span>
<span class="line"><span class="LineNumber">  71 </span><span class="ResWord">if</span> <span class="ID">__name__</span> <span class="Operator">==</span> <span class="String">'__main__'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  72 </span>    <span class="ID">app</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">PySimpleApp</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  73 </span>    <span class="ID">frame</span> <span class="Operator">=</span> <span class="ID">RefactorExample</span><span class="Operator">(</span><span class="ID">parent</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">,</span> <span class="ID">id</span><span class="Operator">=</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  74 </span>    <span class="ID">frame</span><span class="Operator">.</span><span class="ID">Show</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  75 </span>    <span class="ID">app</span><span class="Operator">.</span><span class="ID">MainLoop</span><span class="Operator">(</span><span class="Operator">)</span><span class="Text"/></span>
</pre></div><span id="line-118" class="anchor"/><span id="line-119" class="anchor"/><p class="line874">根据重构原则，上面这段代码有一点是做到了，就是没有深的嵌套。其它都没有做到。 <span id="line-120" class="anchor"/>为了让你有一个关于如何调整的一个思想，我们将把所有的按钮代码分别放到各自的方法中。 <span id="line-121" class="anchor"/>下表5.2归纳了我们重构原代码应解决的问题 <span id="line-122" class="anchor"/><span id="line-123" class="anchor"/></p><p class="line874">表5.2 <span id="line-124" class="anchor"/><span id="line-125" class="anchor"/></p><p class="line867"><strong>原则</strong> <span
id="line-126" class="anchor"/><strong>代码要重构的地方</strong> <span id="line-127" class="anchor"/><span id="line-128" class="anchor"/></p><p class="line874">不要重复几个模式不断重复，包括“增加按钮，关联一个方法”， <span id="line-129" class="anchor"/></p><ul><li style="list-style-type: none;">“增加菜单项并关联一个方法”，“创建成对的标签/文本条目” <span id="line-130" class="anchor"/><span id="line-131" class="anchor"/></li></ul><p class="line862">一次只做一件事代码做了几件事情。除了基本的框架(<tt>frame)</tt>设置外，它创建了菜单栏，增加了按 <span id="line-132" class="anchor"/></p><ul><li
style="list-style-type: none;">钮，增加了文本域。更糟糕的是，功能在代码中混在一起。 <span id="line-133" class="anchor"/><span id="line-134" class="anchor"/></li></ul><p class="line874">避免避免字面意 <span id="line-135" class="anchor"/>义上的字符串和数字在构造器中每个按钮、菜单项和文本框都有一个文字字符串和坐标常量 <span id="line-136" class="anchor"/><span id="line-137" class="anchor"/><span id="line-138" class="anchor"/></p><p class="line867">
</p><h3 id="head-e079ce7b0227a1554c04609a0f21eb0d4978b172">1.1.2. 开始重构</h3>
<span id="line-139" class="anchor"/><span id="line-140" class="anchor"/><span id="line-141" class="anchor"/><p class="line874">例5.2中只包含了前面用于创建按键栏的代码。作为重构的第一步，我们在例5.2中把例5.1中创建按钮栏这些代码抽出来放在了它自己的方法中： <span id="line-142" class="anchor"/><span id="line-143" class="anchor"/><span id="line-144" class="anchor"/></p><p class="line867"><strong>例5.2</strong> <span id="line-145" class="anchor"/><strong>按钮栏作为一个单独的方法</strong> <span id="line-146" class="anchor"/><span id="line-147" class="anchor"/><span id="line-148" class="anchor"/><span
id="line-149" class="anchor"/><span id="line-150" class="anchor"/><span id="line-151" class="anchor"/><span id="line-152" class="anchor"/><span id="line-153" class="anchor"/><span id="line-154" class="anchor"/><span id="line-155" class="anchor"/><span id="line-156" class="anchor"/><span id="line-157" class="anchor"/><span id="line-158" class="anchor"/><span id="line-159" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-07e1916d84c23826ab53dc1ed7046c3f23e8e80b_001\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-07e1916d84c23826ab53dc1ed7046c3f23e8e80b_001', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-07e1916d84c23826ab53dc1ed7046c3f23e8e80b_001" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">def</span> <span class="ID">createButtonBar</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   2 </span>        <span class="ID">firstButton</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"FIRST"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   3 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnFirst</span><span class="Operator">,</span> <span class="ID">firstButton</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   4 </span></span>
<span class="line"><span class="LineNumber">   5 </span>        <span class="ID">prevButton</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"   PREV"</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span
class="Number">80</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   6 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnPrev</span><span class="Operator">,</span> <span class="ID">prevButton</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   7 </span></span>
<span class="line"><span class="LineNumber">   8 </span>        <span class="ID">nextButton</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"NEXT   "</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span
class="Number">160</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnNext</span><span class="Operator">,</span> <span class="ID">nextButton</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  10 </span></span>
<span class="line"><span class="LineNumber">  11 </span>        <span class="ID">lastButton</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"LAST"</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span
class="Number">240</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  12 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnLast</span><span class="Operator">,</span> <span class="ID">lastButton</span><span class="Operator">)</span><span class="Text"/></span>
</pre></div><span id="line-160" class="anchor"/><p class="line874">向上面这样把代码分离出后，所有按钮添加代码之间的共性就很容易看出来了。我们可以把添加按钮的代码写成一个公用的方法来调用 ，而避免了重复。如例5.3所示： <span id="line-161" class="anchor"/><span id="line-162" class="anchor"/><span id="line-163" class="anchor"/></p><p class="line867"><strong>例5.3</strong> <span id="line-164" class="anchor"/><strong>一个公用的改进了的按钮栏方法</strong> <span id="line-165" class="anchor"/><span id="line-166" class="anchor"/><span id="line-167" class="anchor"/><span id="line-168"
class="anchor"/><span id="line-169" class="anchor"/><span id="line-170" class="anchor"/><span id="line-171" class="anchor"/><span id="line-172" class="anchor"/><span id="line-173" class="anchor"/><span id="line-174" class="anchor"/><span id="line-175" class="anchor"/><span id="line-176" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-a0db1944b89b654a4b140ea42491071db0fa380a_002\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-a0db1944b89b654a4b140ea42491071db0fa380a_002', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-a0db1944b89b654a4b140ea42491071db0fa380a_002" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">def</span> <span class="ID">createButtonBar</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">panel</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   2 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="String">"First"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnFirst</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   3 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="String">"   PREV"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnPrev</span><span class="Operator">,</span> <span class="Operator">(</span><span class="Number">80</span><span class="Operator">,</span> <span class="Number">0</span><span
class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   4 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="String">"NEXT   "</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnNext</span><span class="Operator">,</span> <span class="Operator">(</span><span class="Number">160</span><span class="Operator">,</span> <span class="Number">0</span><span
class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   5 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="String">"Last"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnLast</span><span class="Operator">,</span> <span class="Operator">(</span><span class="Number">240</span><span class="Operator">,</span> <span class="Number">0</span><span
class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   6 </span></span>
<span class="line"><span class="LineNumber">   7 </span><span class="ResWord">def</span> <span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">handler</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">0</span><span class="Operator">,</span><span
class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   8 </span>        <span class="ID">button</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">handler</span><span class="Operator">,</span> <span class="ID">button</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  10 </span>        <span class="ResWord">return</span> <span class="ID">button</span><span class="Text"/></span>
</pre></div><span id="line-177" class="anchor"/><span id="line-178" class="anchor"/><p
class="line862">例5.3代替例5.2有两个好处。第一，简短的方法和有意义的方法名使得代码的可读性更清晰了。第二，它避免了局部变量（诚然，你也可以通过使用<tt>ID</tt>来避免使用局部变量，但那容易导致重复的<tt>ID</tt>问题）。不使用局部变量是有好处的，它减少了代码的复杂程序，并且也因为这样几乎排除了通常由剪切和粘贴部分代码而忘记了改变所有变量的名字带来的错误。（在实际的应用中，你可能需要存储按钮为实例变量以备后来访问，但是本例不需要。）另外，<tt>buildOneButton()</tt>方法容易放进一个工具模块中并可以在别的框架或项目中重用。 <span id="line-179" class="anchor"/><span id="line-180"
class="anchor"/><span id="line-181" class="anchor"/><span id="line-182" class="anchor"/><span id="line-183" class="anchor"/></p><p class="line867">
</p><h3 id="head-6f348cd094a4cf060d7547d791a17ffd7d5613b2">1.1.3. 进一步重构</h3>
<span id="line-184" class="anchor"/><span id="line-185" class="anchor"/><span id="line-186" class="anchor"/><p class="line874">上面的例子，已经得到了很多的改善。但是在多处仍有许多常量。其一，就是用于定位的点坐标，当另一 <span id="line-187" class="anchor"/>个按钮被添加到按钮栏时可能使代码产生错误，尤其是新的按钮被放置在按钮栏的中间。因此让我们再往 <span id="line-188" class="anchor"/>前进一步，我们把这些字面意义上的数据从处理中分离出来。下例5.4展示了一个用于创建按钮的数据驱 <span id="line-189" class="anchor"/>动机制。 <span id="line-190" class="anchor"/><span
id="line-191" class="anchor"/></p><p class="line874">例5.4 使用分离自代码的数据创建按钮 <span id="line-192" class="anchor"/><span id="line-193" class="anchor"/><span id="line-194" class="anchor"/><span id="line-195" class="anchor"/><span id="line-196" class="anchor"/><span id="line-197" class="anchor"/><span id="line-198" class="anchor"/><span id="line-199" class="anchor"/><span id="line-200" class="anchor"/><span id="line-201" class="anchor"/><span id="line-202" class="anchor"/><span id="line-203" class="anchor"/><span id="line-204" class="anchor"/><span id="line-205"
class="anchor"/><span id="line-206" class="anchor"/><span id="line-207" class="anchor"/><span id="line-208" class="anchor"/><span id="line-209" class="anchor"/><span id="line-210" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-16628b9d4c01c882d6e58154c22f732312c4f1ce_003\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-16628b9d4c01c882d6e58154c22f732312c4f1ce_003', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-16628b9d4c01c882d6e58154c22f732312c4f1ce_003" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">def</span> <span class="ID">buttonData</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   2 </span>        <span class="ResWord">return</span> <span class="Operator">(</span><span class="Operator">(</span><span class="String">"First"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnFirst</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">   3 </span>                <span class="Operator">(</span><span class="String">"   PREV"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnPrev</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">   4 </span>                <span class="Operator">(</span><span class="String">"NEXT   "</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnNext</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">   5 </span>                <span class="Operator">(</span><span class="String">"Last"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnLast</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   6 </span></span>
<span class="line"><span class="LineNumber">   7 </span><span class="ResWord">def</span> <span class="ID">createButtonBar</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">panel</span><span class="Operator">,</span> <span class="ID">yPos</span><span class="Operator">=</span><span class="Number">0</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   8 </span>        <span class="ID">xPos</span> <span class="Operator">=</span> <span class="Number">0</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ResWord">for</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachHandler</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">buttonData</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  10 </span>                <span class="ID">pos</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="ID">xPos</span><span class="Operator">,</span> <span class="ID">yPos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  11 </span>                <span class="ID">button</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachHandler</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  12 </span>                <span class="ID">xPos</span> <span class="Operator">+=</span> <span class="ID">button</span><span class="Operator">.</span><span class="ID">GetSize</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">width</span></span>
<span class="line"><span class="LineNumber">  13 </span></span>
<span class="line"><span class="LineNumber">  14 </span><span class="ResWord">def</span> <span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">handler</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">0</span><span class="Operator">,</span><span
class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  15 </span>        <span class="ID">button</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  16 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">handler</span><span class="Operator">,</span> <span class="ID">button</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  17 </span>        <span class="ResWord">return</span> <span class="ID">button</span><span class="Text"/></span>
</pre></div><span id="line-211" class="anchor"/><p class="line862">在例5.4中，用于不同按钮的数据被存储在内嵌于<tt>buttonData()</tt>方法的元组中。所选的数据结构及常量方 <span id="line-212" class="anchor"/>法的使用不是必然的。数据也可以被存储在一个类级的变量或模块级的变量中，而非一个方法的结果，或 <span id="line-213" class="anchor"/>存储于一个外部的文件中。使用方法的好处就是，如果你的按钮数据存储在另一个地方而不是方法中的话 <span id="line-214" class="anchor"/>，只需要改变这个方法而使它返回外部的数据。 <span id="line-215" class="anchor"/><span
id="line-216" class="anchor"/></p><p class="line867"><tt>createButtonBar()</tt>方法遍历<tt>buttonData()</tt>返回的列表并创建相关数据的按钮。这个方法集依次根据列表 <span id="line-217" class="anchor"/>自动计算按钮的x坐标。这是很有帮助的，因为它保证了代码中按钮的次序与将显示在屏幕中的次序一样 <span id="line-218" class="anchor"/>，使得代码更清晰并减少出错的机会。如果你需要将一个按钮添加到按钮栏的中间的话，你只需把数据添 <span id="line-219" class="anchor"/>加到这个列表的中间，这个代码确保了所加按钮被放置在中间。 <span id="line-220" class="anchor"/><span
id="line-221" class="anchor"/></p><p class="line862">数据的分离有其它的好处。在一个更精心制作的例子中，数据可以被存储到一个外部的资源或<tt>XML</tt>文件中 <span id="line-222" class="anchor"/>。这使得在改变界面的时候不用去关心代码，并且使国际化更容易，很容易改变文本。移除了数据以后， <span id="line-223" class="anchor"/><tt>createButtonBar</tt>方法现在成了一个公用方法了，它可以容易地在其它框架或项目中被重用。 <span id="line-224" class="anchor"/>在经过整合相同的过程，并从菜单和文本域代码中分离出数据后，所得的结果显示在如下例5.5中。 <span id="line-225"
class="anchor"/><span id="line-226" class="anchor"/></p><p class="line874">例5.5 一个重构的例子 <span id="line-227" class="anchor"/><span id="line-228" class="anchor"/><span id="line-229" class="anchor"/><span id="line-230" class="anchor"/><span id="line-231" class="anchor"/><span id="line-232" class="anchor"/><span id="line-233" class="anchor"/><span id="line-234" class="anchor"/><span id="line-235" class="anchor"/><span id="line-236" class="anchor"/><span id="line-237" class="anchor"/><span id="line-238" class="anchor"/><span id="line-239"
class="anchor"/><span id="line-240" class="anchor"/><span id="line-241" class="anchor"/><span id="line-242" class="anchor"/><span id="line-243" class="anchor"/><span id="line-244" class="anchor"/><span id="line-245" class="anchor"/><span id="line-246" class="anchor"/><span id="line-247" class="anchor"/><span id="line-248" class="anchor"/><span id="line-249" class="anchor"/><span id="line-250" class="anchor"/><span id="line-251" class="anchor"/><span id="line-252" class="anchor"/><span id="line-253" class="anchor"/><span id="line-254"
class="anchor"/><span id="line-255" class="anchor"/><span id="line-256" class="anchor"/><span id="line-257" class="anchor"/><span id="line-258" class="anchor"/><span id="line-259" class="anchor"/><span id="line-260" class="anchor"/><span id="line-261" class="anchor"/><span id="line-262" class="anchor"/><span id="line-263" class="anchor"/><span id="line-264" class="anchor"/><span id="line-265" class="anchor"/><span id="line-266" class="anchor"/><span id="line-267" class="anchor"/><span id="line-268" class="anchor"/><span id="line-269"
class="anchor"/><span id="line-270" class="anchor"/><span id="line-271" class="anchor"/><span id="line-272" class="anchor"/><span id="line-273" class="anchor"/><span id="line-274" class="anchor"/><span id="line-275" class="anchor"/><span id="line-276" class="anchor"/><span id="line-277" class="anchor"/><span id="line-278" class="anchor"/><span id="line-279" class="anchor"/><span id="line-280" class="anchor"/><span id="line-281" class="anchor"/><span id="line-282" class="anchor"/><span id="line-283" class="anchor"/><span id="line-284"
class="anchor"/><span id="line-285" class="anchor"/><span id="line-286" class="anchor"/><span id="line-287" class="anchor"/><span id="line-288" class="anchor"/><span id="line-289" class="anchor"/><span id="line-290" class="anchor"/><span id="line-291" class="anchor"/><span id="line-292" class="anchor"/><span id="line-293" class="anchor"/><span id="line-294" class="anchor"/><span id="line-295" class="anchor"/><span id="line-296" class="anchor"/><span id="line-297" class="anchor"/><span id="line-298" class="anchor"/><span id="line-299"
class="anchor"/><span id="line-300" class="anchor"/><span id="line-301" class="anchor"/><span id="line-302" class="anchor"/><span id="line-303" class="anchor"/><span id="line-304" class="anchor"/><span id="line-305" class="anchor"/><span id="line-306" class="anchor"/><span id="line-307" class="anchor"/><span id="line-308" class="anchor"/><span id="line-309" class="anchor"/><span id="line-310" class="anchor"/><span id="line-311" class="anchor"/><span id="line-312" class="anchor"/><span id="line-313" class="anchor"/><span id="line-314"
class="anchor"/><span id="line-315" class="anchor"/><span id="line-316" class="anchor"/><span id="line-317" class="anchor"/><span id="line-318" class="anchor"/><span id="line-319" class="anchor"/><span id="line-320" class="anchor"/><span id="line-321" class="anchor"/><span id="line-322" class="anchor"/><span id="line-323" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-821c7fd145df0c71bba9a8448be9f8192eb9aaa5_004\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-821c7fd145df0c71bba9a8448be9f8192eb9aaa5_004', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-821c7fd145df0c71bba9a8448be9f8192eb9aaa5_004" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="Comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="Comment"/></span>
<span class="line"><span class="LineNumber">   3 </span><span class="ResWord">import</span> <span class="ID">wx</span></span>
<span class="line"><span class="LineNumber">   4 </span></span>
<span class="line"><span class="LineNumber">   5 </span><span class="ResWord">class</span> <span class="ID">RefactorExample</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   6 </span></span>
<span class="line"><span class="LineNumber">   7 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">id</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   8 </span>                <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">id</span><span class="Operator">,</span> <span class="String">'Refactor Example'</span><span class="Operator">,</span><span class="ID">size</span><span
class="Operator">=</span><span class="Operator">(</span><span class="Number">340</span><span class="Operator">,</span> <span class="Number">200</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   9 </span>                <span class="ID">panel</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Panel</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  10 </span>                <span class="ID">panel</span><span class="Operator">.</span><span class="ID">SetBackgroundColour</span><span class="Operator">(</span><span class="String">"White"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  11 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_CLOSE</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnCloseWindow</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  12 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">createMenuBar</span><span class="Operator">(</span><span class="Operator">)</span> <span class="Comment">#简化的init方法</span></span>
<span class="line"><span class="LineNumber">  13 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">createButtonBar</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  14 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">createTextFields</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  15 </span></span>
<span class="line"><span class="LineNumber">  16 </span>        <span class="ResWord">def</span> <span class="ID">menuData</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#菜单数据</span></span>
<span class="line"><span class="LineNumber">  17 </span>                <span class="ResWord">return</span> <span class="Operator">(</span><span class="Operator">(</span><span class="String">"&File"</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  18 </span>                        <span class="Operator">(</span><span class="String">"&Open"</span><span class="Operator">,</span> <span class="String">"Open in status bar"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnOpen</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  19 </span>                        <span class="Operator">(</span><span class="String">"&Quit"</span><span class="Operator">,</span> <span class="String">"Quit"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnCloseWindow</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  20 </span>                        <span class="Operator">(</span><span class="String">"&Edit"</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  21 </span>                        <span class="Operator">(</span><span class="String">"&Copy"</span><span class="Operator">,</span> <span class="String">"Copy"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnCopy</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  22 </span>                        <span class="Operator">(</span><span class="String">"C&ut"</span><span class="Operator">,</span> <span class="String">"Cut"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnCut</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  23 </span>                        <span class="Operator">(</span><span class="String">"&Paste"</span><span class="Operator">,</span> <span class="String">"Paste"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnPaste</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  24 </span>                        <span class="Operator">(</span><span class="String">""</span><span class="Operator">,</span> <span class="String">""</span><span class="Operator">,</span> <span class="String">""</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  25 </span>                        <span class="Operator">(</span><span class="String">"&Options"</span><span class="Operator">,</span> <span class="String">"DisplayOptions"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnOptions</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  26 </span><span class="Comment">#创建菜单</span></span>
<span class="line"><span class="LineNumber">  27 </span><span class="Comment"/>        <span class="ResWord">def</span> <span class="ID">createMenuBar</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  28 </span>                <span class="ID">menuBar</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">MenuBar</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  29 </span>                <span class="ResWord">for</span> <span class="ID">eachMenuData</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">menuData</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  30 </span>                        <span class="ID">menuLabel</span> <span class="Operator">=</span> <span class="ID">eachMenuData</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  31 </span>                        <span class="ID">menuItems</span> <span class="Operator">=</span> <span class="ID">eachMenuData</span><span class="Operator">[</span><span class="Number">1</span><span class="Operator">:</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  32 </span>                        <span class="ID">menuBar</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">createMenu</span><span class="Operator">(</span><span class="ID">menuItems</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">menuLabel</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  33 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetMenuBar</span><span class="Operator">(</span><span class="ID">menuBar</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  34 </span></span>
<span class="line"><span class="LineNumber">  35 </span>        <span class="ResWord">def</span> <span class="ID">createMenu</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">menuData</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  36 </span>                <span class="ID">menu</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Menu</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  37 </span>                <span class="ResWord">for</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachStatus</span><span class="Operator">,</span> <span class="ID">eachHandler</span> <span class="ResWord">in</span> <span class="ID">menuData</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  38 </span>                        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">eachLabel</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  39 </span>                                <span class="ID">menu</span><span class="Operator">.</span><span class="ID">AppendSeparator</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  40 </span>                                <span class="ResWord">continue</span></span>
<span class="line"><span class="LineNumber">  41 </span>                        <span class="ID">menuItem</span> <span class="Operator">=</span> <span class="ID">menu</span><span class="Operator">.</span><span class="ID">Append</span><span class="Operator">(</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachStatus</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  42 </span>                        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_MENU</span><span class="Operator">,</span> <span class="ID">eachHandler</span><span class="Operator">,</span> <span class="ID">menuItem</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  43 </span>                <span class="ResWord">return</span> <span class="ID">menu</span></span>
<span class="line"><span class="LineNumber">  44 </span></span>
<span class="line"><span class="LineNumber">  45 </span>        <span class="ResWord">def</span> <span class="ID">buttonData</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#按钮栏数据</span></span>
<span class="line"><span class="LineNumber">  46 </span>                <span class="ResWord">return</span> <span class="Operator">(</span><span class="Operator">(</span><span class="String">"First"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnFirst</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  47 </span>                        <span class="Operator">(</span><span class="String">"<<  PREV"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnPrev</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  48 </span>                        <span class="Operator">(</span><span class="String">"NEXT >>"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnNext</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  49 </span>                        <span class="Operator">(</span><span class="String">"Last"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnLast</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  50 </span>        <span class="Comment">#创建按钮</span></span>
<span class="line"><span class="LineNumber">  51 </span><span class="Comment"/>        <span class="ResWord">def</span> <span class="ID">createButtonBar</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">panel</span><span class="Operator">,</span> <span class="ID">yPos</span> <span class="Operator">=</span> <span class="Number">0</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  52 </span>                <span class="ID">xPos</span> <span class="Operator">=</span> <span class="Number">0</span></span>
<span class="line"><span class="LineNumber">  53 </span>                <span class="ResWord">for</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachHandler</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">buttonData</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  54 </span>                        <span class="ID">pos</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="ID">xPos</span><span class="Operator">,</span> <span class="ID">yPos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  55 </span>                        <span class="ID">button</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">eachLabel</span><span class="Operator">,</span><span class="ID">eachHandler</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  56 </span>                        <span class="ID">xPos</span> <span class="Operator">+=</span> <span class="ID">button</span><span class="Operator">.</span><span class="ID">GetSize</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">width</span></span>
<span class="line"><span class="LineNumber">  57 </span></span>
<span class="line"><span class="LineNumber">  58 </span>        <span class="ResWord">def</span> <span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">handler</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">0</span><span
class="Operator">,</span><span class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  59 </span>                <span class="ID">button</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  60 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">handler</span><span class="Operator">,</span> <span class="ID">button</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  61 </span>                <span class="ResWord">return</span> <span class="ID">button</span></span>
<span class="line"><span class="LineNumber">  62 </span></span>
<span class="line"><span class="LineNumber">  63 </span>        <span class="ResWord">def</span> <span class="ID">textFieldData</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#文本数据</span></span>
<span class="line"><span class="LineNumber">  64 </span>                <span class="ResWord">return</span> <span class="Operator">(</span><span class="Operator">(</span><span class="String">"First Name"</span><span class="Operator">,</span> <span class="Operator">(</span><span class="Number">10</span><span class="Operator">,</span> <span class="Number">50</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  65 </span>                        <span class="Operator">(</span><span class="String">"Last Name"</span><span class="Operator">,</span> <span class="Operator">(</span><span class="Number">10</span><span class="Operator">,</span> <span class="Number">80</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  66 </span>        <span class="Comment">#创建文本</span></span>
<span class="line"><span class="LineNumber">  67 </span><span class="Comment"/></span>
<span class="line"><span class="LineNumber">  68 </span>        <span class="ResWord">def</span> <span class="ID">createTextFields</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">panel</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  69 </span>                <span class="ResWord">for</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachPos</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">textFieldData</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  70 </span>                        <span class="ID">self</span><span class="Operator">.</span><span class="ID">createCaptionedText</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachPos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  71 </span></span>
<span class="line"><span class="LineNumber">  72 </span>        <span class="ResWord">def</span> <span class="ID">createCaptionedText</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">panel</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  73 </span>                <span class="ID">static</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">StaticText</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">NewId</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">label</span><span
class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  74 </span>                <span class="ID">static</span><span class="Operator">.</span><span class="ID">SetBackgroundColour</span><span class="Operator">(</span><span class="String">"White"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  75 </span>                <span class="ID">textPos</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="ID">pos</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span> <span class="Operator">+</span> <span class="Number">75</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">[</span><span class="Number">1</span><span class="Operator">]</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  76 </span>                <span class="ID">wx</span><span class="Operator">.</span><span class="ID">TextCtrl</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">NewId</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">,</span> <span class="String">""</span><span class="Operator">,</span> <span class="ID">size</span><span
class="Operator">=</span><span class="Operator">(</span><span class="Number">100</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">=</span><span class="ID">textPos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  77 </span></span>
<span class="line"><span class="LineNumber">  78 </span>        <span class="Comment"># 空的事件处理器放在一起</span></span>
<span class="line"><span class="LineNumber">  79 </span><span class="Comment"/>        <span class="ResWord">def</span> <span class="ID">OnPrev</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  80 </span>        <span class="ResWord">def</span> <span class="ID">OnNext</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  81 </span>        <span class="ResWord">def</span> <span class="ID">OnLast</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  82 </span>        <span class="ResWord">def</span> <span class="ID">OnFirst</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  83 </span>        <span class="ResWord">def</span> <span class="ID">OnOpen</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  84 </span>        <span class="ResWord">def</span> <span class="ID">OnCopy</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  85 </span>        <span class="ResWord">def</span> <span class="ID">OnCut</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  86 </span>        <span class="ResWord">def</span> <span class="ID">OnPaste</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  87 </span>        <span class="ResWord">def</span> <span class="ID">OnOptions</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span> <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  88 </span>        <span class="ResWord">def</span> <span class="ID">OnCloseWindow</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  89 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Destroy</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  90 </span></span>
<span class="line"><span class="LineNumber">  91 </span><span class="ResWord">if</span> <span class="ID">__name__</span> <span class="Operator">==</span> <span class="String">'__main__'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  92 </span>        <span class="ID">app</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">PySimpleApp</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  93 </span>        <span class="ID">frame</span> <span class="Operator">=</span> <span class="ID">RefactorExample</span><span class="Operator">(</span><span class="ID">parent</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">,</span> <span class="ID">id</span><span class="Operator">=</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  94 </span>        <span class="ID">frame</span><span class="Operator">.</span><span class="ID">Show</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  95 </span>        <span class="ID">app</span><span class="Operator">.</span><span class="ID">MainLoop</span><span class="Operator">(</span><span class="Operator">)</span><span class="Text"/></span>
</pre></div><span id="line-324" class="anchor"/><span id="line-325" class="anchor"/><p class="line874">从例5.1改变到例5.5，没有费多少力，但我们所得到的却是很多——代码非常的清楚且减少了出错的机会。代码的布置与数据的布置在逻辑上是匹配的。那些普通的做法（它们劣质的代码结构可能导致错误——如采用大量的复制和粘贴来创建新的对象）已经被去掉。多数函数现在可以很容易地被移到一个超类或公用模块中，以保存代码便于以后继续利用。另外，数据的分离使得把这个布局作为不同数据的模板很容易，包括国际化的数据。 <span id="line-326" class="anchor"/><span id="line-327"
class="anchor"/></p><p class="line862">重构虽说完成了，但是例5.5中的代码仍然忽略了一些重要的事情：实际用户的数据。你的应用程序要做很多事依赖于处理数据响应用户要求。你的程序的结构还可以向着灵活性和稳定性方向发展。<tt>MVC</tt>模式对于管理界面和数据之间的交互是公认的标准。 <span id="line-328" class="anchor"/><span id="line-329" class="anchor"/><span id="line-330" class="anchor"/><span id="line-331" class="anchor"/></p><p class="line867">
</p><h2 id="head-04a6951c1b341d13ec7b71bc0dc78fa16b4c4657">1.2. 如何保持模型(Model)与视图(View)分离？</h2>
<span id="line-332" class="anchor"/><span id="line-333" class="anchor"/><span id="line-334" class="anchor"/><p class="line862">最早可追溯到1970年代后期和<tt>Smalltalk</tt>-80语言，<tt>MVC</tt>模式大概是最早明确指出面向对象设计的模式。它是最流行的一种，被几乎所有<tt>GUI</tt>工具包所采用。<tt>MVC</tt>模式是结构化程序的标准，包括处理和显示信息。 <span id="line-335" class="anchor"/><span id="line-336" class="anchor"/></p><p class="line867">
</p><h3 id="head-3a64788772284f7f47f007ac1de04115b65f31b5">1.2.1. MVC(Model-View-Controller)系统是什么？</h3>
<span id="line-337" class="anchor"/><span id="line-338" class="anchor"/><span id="line-339" class="anchor"/><p class="line867"><tt>MVC</tt>系统有三个子系统。<tt>Model</tt>包含经常被调用的业务逻辑或由你的系统处理的所有数据和信息。<tt>View</tt>包含显示数据的对象，<tt>Controller</tt>管理与用户的交互（<tt>Controller</tt>处于<tt>Model</tt>和<tt>view</tt>中间）。下表5.3归纳了这些组分。 <span id="line-340" class="anchor"/><span id="line-341" class="anchor"/><span id="line-342" class="anchor"/></p><p class="line867"><strong>表5.3</strong> <span
id="line-343" class="anchor"/><strong>标准<tt>MVC</tt>体系的组成</strong> <span id="line-344" class="anchor"/><span id="line-345" class="anchor"/><span id="line-346" class="anchor"/></p><p class="line867"><strong>组分</strong> <span id="line-347" class="anchor"/><span id="line-348" class="anchor"/></p><p class="line867"><tt>Model</tt>：包含业务逻辑,包含所有由系统处理的数据。它包括一个针对外部存储（如一个数据库）的接口。通常模型(<tt>model)</tt>只暴露一个公共的<tt>API</tt>给其它的组分。 <span id="line-349" class="anchor"/><span
id="line-350" class="anchor"/></p><p class="line867"><tt>View</tt>：包含显示代码。这个窗口部件实际用于放置用户在视图中的信息。在<tt>wxPython</tt>中，处于<tt>wx.Window</tt>层级中的所有的东西都是视图(<tt>view)</tt>子系统的一部分。 <span id="line-351" class="anchor"/><span id="line-352" class="anchor"/></p><p class="line867"><tt>Controller</tt>：包含交互逻辑。该代码接受用户事件并确保它们被系统处理。在<tt>wxPython</tt>中，这个子系统由<tt>wx.EvtHandler</tt>层级所代表。 <span id="line-353" class="anchor"/><span id="line-354"
class="anchor"/></p><p
class="line862">在现代的<tt>UI</tt>工具包中，<tt>View</tt>和<tt>Controller</tt>组分是被集成在一起的。这是因为<tt>Controller</tt>组分自身需要被显示在屏幕上，并且因为经常性的你想让显示数据的窗口部件也响应用户事件。在<tt>wxPython</tt>中，这种关系实际上已经被放置进去了（所有的<tt>wx.Window</tt>对象也都是<tt>wx.EvtHandler</tt>的子类），这意味着它们同时具有<tt>View</tt>元素和<tt>Controller</tt>元素的功能。相比之下，大部分<tt>web</tt>应用架构对于<tt>View</tt>和<tt>Controller</tt>有更严格的分离，因为其交互逻辑发生在服务器的后台。 <span
id="line-355" class="anchor"/><span id="line-356" class="anchor"/></p><p class="line862">图5.2中显示了数据和信息是如何在<tt>MVC</tt>体系中传递的。 <span id="line-357" class="anchor"/><span id="line-358" class="anchor"/></p><p class="line867"><img title="attachment:w5.2.gif" src="/moin/WxPythonInAction/ChapterFive?action=AttachFile&amp;do=get&amp;target=w5.2.gif" class="attachment"/> <span id="line-359" class="anchor"/><span id="line-360" class="anchor"/><span id="line-361" class="anchor"/></p><p
class="line862">一个事件通知被<tt>Controller</tt>系统处理（它把事件通知放到一个合适的地方）。如我们在第三章中所看到的，<tt>wxPython</tt>使用<tt>wx.EvtHandler</tt>的方法<tt>ProcessEvent()</tt>管理这个机制。在一个严格的<tt>MVC</tt>?杓浦校愕拇砥骱赡鼙簧髟谝桓龅ザ赖目刂破鞫韵笾校窃诳蚣芾嘧陨碇小? <span id="line-362"
class="anchor"/>对于事件的响应，这个模型(<tt>model)</tt>对象可以对应用程序数据做一些处理。当处理完成时，模型对象发送一个更新通知。如果这儿有一个控制器(<tt>controller)</tt>对象，那么该通知通常发送回这个控制器，同时这个控制器对象通知视图(<tt>view)</tt>对象自我更新。在一个较小的系统或一个较简单的体系中，通知通常直接被视图对象所接受。在<tt>wxPython</tt>中，来自于模型的更新的关键在于你。你的选择包括从模型或控制器显式地引发自定义的<tt>wxPython</tt>事件，使模型维护的对象的列表接受更新通知，或使与模型关联的视图接受更新通知。 <span id="line-363"
class="anchor"/><span id="line-364" class="anchor"/></p><p class="line862">一个成功的<tt>MVC</tt>设计的关键不在于每个对象都彼此了解。相反，一个成功的<tt>MVC</tt>程序，它的不同部分之间显式地隐藏了一些东西。其目的是使系统最低限度地交互，和方法之间的明确的界定。尤其，这个<tt>Model</tt>组分应该被完全从<tt>View</tt>和<tt>Controller</tt>中脱离出来。你应该只改变那些系统而不改变你的<tt>Model</tt>类。理想上来讲，你甚至应该能够使用相同<tt>Model</tt>类来驱动非<tt>wxPython</tt>的界面，但是那很难。 <span id="line-365" class="anchor"/><span
id="line-366" class="anchor"/></p><p class="line862">从<tt>View</tt>方面，你应该能够在<tt>Model</tt>对象的实现中做改变而不改变<tt>View</tt>或<tt>Controller</tt>。而<tt>View</tt>依赖于某些公共的方法的存在，它不应该看见<tt>Model</tt>内私有的东西。无可否认，这在<tt>Python</tt>中实施是有困难的，但有一个方法可以帮助我们，那就是创建一个抽象的<tt>Model</tt>类，它定义<tt>View</tt>可以看见的<tt>API</tt>。<tt>Model</tt>的子类可以扮演一个内部的类的代理而被改变，或可以简单地自身包含内部的工作。这第一个方案更结构化些，第二个更容易实现。 <span
id="line-367" class="anchor"/><span id="line-368" class="anchor"/></p><p class="line862">下一节，我们将看一看内建于<tt>wxPython</tt>中的<tt>Model</tt>类中的一个：<tt>wx.grid.PyGridTableBase</tt>。这个类使得在一个<tt>MVC</tt>设计架构中使用<tt>grid</tt>控件成为可能。这之后，我们将关注一下对于一个定制的窗口部件建造和使用定制的模型类。 <span id="line-369" class="anchor"/><span id="line-370" class="anchor"/><span id="line-371" class="anchor"/></p><p class="line867">
</p><h3 id="head-621ac42f84c3562634ee4248ba91e0a180beba2f">1.2.2. 一个wxPython模型：PyGridTableBase</h3>
<span id="line-372" class="anchor"/><span id="line-373" class="anchor"/><span id="line-374" class="anchor"/><p class="line862">类<tt>wx.grid.Grid</tt>是一个电子表格式样的<tt>wxPython</tt>控件。下图5.3显示了它的外观。 <span id="line-375" class="anchor"/><span id="line-376" class="anchor"/></p><p class="line867"><img title="attachment:w5.3.gif" src="/moin/WxPythonInAction/ChapterFive?action=AttachFile&amp;do=get&amp;target=w5.3.gif" class="attachment"/> <span id="line-377" class="anchor"/><span id="line-378" class="anchor"/><span
id="line-379" class="anchor"/></p><p class="line862">这个网格(<tt>grid)</tt>控件有很多有趣的特点，包括能够在一个单元一个单元的基础上创建自定义的渲染器和编辑器，以及可拖拽的行和列。这些特性将在第十三章中做更详细的讨论。在这一章，我们将针对基础和展示如何使用一个模型去填充网格。例5.6显示在一个网格中设置单元值的简单的非模型方法。在此例中，网格中的值是1984年芝加哥小熊队的阵容。 <span id="line-380" class="anchor"/><span id="line-381" class="anchor"/><span id="line-382" class="anchor"/></p><p class="line867"><strong>例5.6</strong> <span
id="line-383" class="anchor"/><strong>填充网格（没有使用模型）</strong> <span id="line-384" class="anchor"/><span id="line-385" class="anchor"/><span id="line-386" class="anchor"/><span id="line-387" class="anchor"/><span id="line-388" class="anchor"/><span id="line-389" class="anchor"/><span id="line-390" class="anchor"/><span id="line-391" class="anchor"/><span id="line-392" class="anchor"/><span id="line-393" class="anchor"/><span id="line-394" class="anchor"/><span id="line-395" class="anchor"/><span id="line-396"
class="anchor"/><span id="line-397" class="anchor"/><span id="line-398" class="anchor"/><span id="line-399" class="anchor"/><span id="line-400" class="anchor"/><span id="line-401" class="anchor"/><span id="line-402" class="anchor"/><span id="line-403" class="anchor"/><span id="line-404" class="anchor"/><span id="line-405" class="anchor"/><span id="line-406" class="anchor"/><span id="line-407" class="anchor"/><span id="line-408" class="anchor"/><span id="line-409" class="anchor"/><span id="line-410" class="anchor"/><span id="line-411"
class="anchor"/><span id="line-412" class="anchor"/><span id="line-413" class="anchor"/><span id="line-414" class="anchor"/><span id="line-415" class="anchor"/><span id="line-416" class="anchor"/><span id="line-417" class="anchor"/><span id="line-418" class="anchor"/><span id="line-419" class="anchor"/><span id="line-420" class="anchor"/><span id="line-421" class="anchor"/><span id="line-422" class="anchor"/><span id="line-423" class="anchor"/><span id="line-424" class="anchor"/><span id="line-425" class="anchor"/><span id="line-426"
class="anchor"/><span id="line-427" class="anchor"/><span id="line-428" class="anchor"/><span id="line-429" class="anchor"/><span id="line-430" class="anchor"/><span id="line-431" class="anchor"/><span id="line-432" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-8e65a28650d2d3482d2c9b1eaa8cd9109032961b_005\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-8e65a28650d2d3482d2c9b1eaa8cd9109032961b_005', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-8e65a28650d2d3482d2c9b1eaa8cd9109032961b_005" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">import</span> <span class="ID">wx</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="ResWord">import</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span></span>
<span class="line"><span class="LineNumber">   3 </span></span>
<span class="line"><span class="LineNumber">   4 </span><span class="ResWord">class</span> <span class="ID">SimpleGrid</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">Grid</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   5 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   6 </span>                <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">Grid</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span
class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   7 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">CreateGrid</span><span class="Operator">(</span><span class="Number">9</span><span class="Operator">,</span> <span class="Number">2</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   8 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetColLabelValue</span><span class="Operator">(</span><span class="Number">0</span><span class="Operator">,</span> <span class="String">"First"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   9 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetColLabelValue</span><span class="Operator">(</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"Last"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  10 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetRowLabelValue</span><span class="Operator">(</span><span class="Number">0</span><span class="Operator">,</span> <span class="String">"CF"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  11 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">0</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">,</span> <span class="String">"Bob"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  12 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">0</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">,</span> <span class="String">"Dernier"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  13 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetRowLabelValue</span><span class="Operator">(</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"2B"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  14 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">1</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">,</span> <span class="String">"Ryne"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  15 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">1</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">,</span> <span class="String">"Sandberg"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  16 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetRowLabelValue</span><span class="Operator">(</span><span class="Number">2</span><span class="Operator">,</span> <span class="String">"LF"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  17 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">2</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">,</span> <span class="String">"Gary"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  18 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">2</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">,</span> <span class="String">"Matthews"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  19 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetRowLabelValue</span><span class="Operator">(</span><span class="Number">3</span><span class="Operator">,</span> <span class="String">"1B"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  20 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">3</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">,</span> <span class="String">"Leon"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  21 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">3</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">,</span> <span class="String">"Durham"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  22 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetRowLabelValue</span><span class="Operator">(</span><span class="Number">4</span><span class="Operator">,</span> <span class="String">"RF"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  23 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">4</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">,</span> <span class="String">"Keith"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  24 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">4</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">,</span> <span class="String">"Moreland"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  25 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetRowLabelValue</span><span class="Operator">(</span><span class="Number">5</span><span class="Operator">,</span> <span class="String">"3B"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  26 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">5</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">,</span> <span class="String">"Ron"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  27 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">5</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">,</span> <span class="String">"Cey"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  28 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetRowLabelValue</span><span class="Operator">(</span><span class="Number">6</span><span class="Operator">,</span> <span class="String">"C"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  29 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">6</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">,</span> <span class="String">"Jody"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  30 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">6</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">,</span> <span class="String">"Davis"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  31 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetRowLabelValue</span><span class="Operator">(</span><span class="Number">7</span><span class="Operator">,</span> <span class="String">"SS"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  32 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">7</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">,</span> <span class="String">"Larry"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  33 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">7</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">,</span> <span class="String">"Bowa"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  34 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetRowLabelValue</span><span class="Operator">(</span><span class="Number">8</span><span class="Operator">,</span> <span class="String">"P"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  35 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">8</span><span class="Operator">,</span> <span class="Number">0</span><span class="Operator">,</span> <span class="String">"Rick"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  36 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetCellValue</span><span class="Operator">(</span><span class="Number">8</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">,</span> <span class="String">"Sutcliffe"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  37 </span></span>
<span class="line"><span class="LineNumber">  38 </span><span class="ResWord">class</span> <span class="ID">TestFrame</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  39 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  40 </span>                <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"A Grid"</span><span
class="Operator">,</span><span class="ID">size</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">275</span><span class="Operator">,</span> <span class="Number">275</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  41 </span>                <span class="ID">grid</span> <span class="Operator">=</span> <span class="ID">SimpleGrid</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  42 </span></span>
<span class="line"><span class="LineNumber">  43 </span><span class="ResWord">if</span> <span class="ID">__name__</span> <span class="Operator">==</span> <span class="String">'__main__'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  44 </span>        <span class="ID">app</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">PySimpleApp</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  45 </span>        <span class="ID">frame</span> <span class="Operator">=</span> <span class="ID">TestFrame</span><span class="Operator">(</span><span class="ID">None</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  46 </span>        <span class="ID">frame</span><span class="Operator">.</span><span class="ID">Show</span><span class="Operator">(</span><span class="ID">True</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  47 </span>        <span class="ID">app</span><span class="Operator">.</span><span class="ID">MainLoop</span><span class="Operator">(</span><span class="Operator">)</span><span class="Text"/></span>
</pre></div><span id="line-433" class="anchor"/><span id="line-434" class="anchor"/><p
class="line862">在例5.6中，我们产生了<tt>SimpleGrid</tt>类，它是<tt>wxPython</tt>类<tt>wx.grid.Grid</tt>的子类。如前所述，<tt>wx.grid.Grid</tt>有很多种方法，这我们以后再讨论。现在，我们只关心方法<tt>SetRowLabelValue()</tt>，<tt>SetColLabelValue()</tt>和<tt>SetCellValue()</tt>，它们实际上设置显示在网格中的值。通过对比图5.3和例5.6你可以明白，<tt>SetCellValue()</tt>方法要求一个行索引、一个列索引和一个值。而其它两个方法要求一个索引和一个值。 <span id="line-435" class="anchor"/><span id="line-436" class="anchor"/></p><p
class="line862">上面的代码使用了<tt>set</tt>***的方法直接把值赋给了网格。然而如果对于一个较大的网格使用这种方法，代码将冗长乏味，并很容易导致错误的出现。即使我们创建公用程序以减轻负担，但是根据重构的原则，代码仍有问题。数据与显示混在一起，对于将来代码的修改是困难的，如增加一列或更换数据。 <span id="line-437" class="anchor"/><span id="line-438" class="anchor"/></p><p
class="line862">解决的答案就是<tt>wx.grid.PyGridTableBase</tt>。根据之前我们所见过的其它的类，前缀<tt>Py</tt>表明这是一个封装了C++类的特定的<tt>Python</tt>类。就像我们在第三章中所见的<tt>PyEvent</tt>类，<tt>PyGridTableBase</tt>的实现是基于简单封装一个<tt>wxWidgets</tt> C++类，这样的目的是使得能够继续声明该类(<tt>Python</tt>形式的类)的子类。<tt>PyGridTableBase</tt>对于网格是一个模型类。也就是说，网格对象可能使用<tt>PyGridTableBase</tt>所包含的方法来绘制自身，而不必了解有关绘制数据的内部结构。 <span id="line-439"
class="anchor"/><span id="line-440" class="anchor"/><span id="line-441" class="anchor"/></p><p class="line867"><strong><tt>PyGridTableBase</tt>的方法</strong> <span id="line-442" class="anchor"/><span id="line-443" class="anchor"/></p><p class="line867"><tt>wx.grid.PyGridTableBase</tt>有一些方法，它们中的许多你不会用到。这个类是抽象的，并且不能被直接实 <span id="line-444" class="anchor"/>例化。每次你创建一个<tt>PyGridTableBase</tt>时，有五个必要的方法必须被定义。表5.4说明了这些方法。 <span id="line-445"
class="anchor"/><span id="line-446" class="anchor"/><span id="line-447" class="anchor"/></p><p class="line867"><strong>表5.4</strong> <span id="line-448" class="anchor"/><strong><tt>wx.grid.PyGridTableBase</tt>的必须的方法</strong> <span id="line-449" class="anchor"/><span id="line-450" class="anchor"/></p><p class="line867"><tt>GetNumberRows()</tt>：返回一个表明<tt>grid</tt>中行数的整数。 <span id="line-451" class="anchor"/><span id="line-452" class="anchor"/></p><p
class="line867"><tt>GetNumberCols()</tt>：返回一个表明<tt>grid</tt>中列数的整数。 <span id="line-453" class="anchor"/><span id="line-454" class="anchor"/></p><p class="line867"><tt>IsEmptyCell(row</tt>, <tt>col)</tt>：如果索引(<tt>row</tt>,<tt>col)</tt>所表示的单元是空的话，返回<tt>True</tt>。 <span id="line-455" class="anchor"/><span id="line-456" class="anchor"/></p><p class="line867"><tt>GetValue(row</tt>, <tt>col)</tt>：返回显示在单元(<tt>row</tt>,<tt>col)</tt>中的值。 <span id="line-457" class="anchor"/><span
id="line-458" class="anchor"/></p><p class="line867"><tt>SetValue(row</tt>, <tt>col</tt>,<tt>value)</tt>：设置单元(<tt>row</tt>,<tt>col)</tt>中的值。如果你想要只读模式，你仍必须包含这个方法，但是你可以在该函数中使用<tt>pass</tt>。 <span id="line-459" class="anchor"/><span id="line-460" class="anchor"/></p><p class="line862">表(<tt>table)</tt>通过使用网格(<tt>grid)</tt>的<tt>SetTable()</tt>方法被附加在<tt>grid</tt>上。在属性被设置后，<tt>grid</tt>对象将调用表 <span id="line-461"
class="anchor"/>的方法来得到它绘制网格所需要的信息。<tt>grid</tt>不再显式使用<tt>grid</tt>的方法来设置值。 <span id="line-462" class="anchor"/><span id="line-463" class="anchor"/><span id="line-464" class="anchor"/></p><p class="line867"><strong>使用<tt>PyGridTableBase</tt></strong> <span id="line-465" class="anchor"/><span id="line-466" class="anchor"/></p><p
class="line862">一般情况下，有两种使用<tt>PyGridTableBase</tt>的方法。你可以显式地使你的模型类是<tt>PyGridTableBase</tt>的子类，或你可以创建一个单独的<tt>PyGridTableBase</tt>的子类，它关联你的实际的模型类。当你的数据不是太复杂 <span id="line-467"
class="anchor"/>的时候，第一种方案较简单并且直观。第二种方案需要对模型和视图做很好的分离，如果你的数据复杂的话，这第二种方案是更好的。如果你有一个预先存在的数据类，你想把它用于<tt>wxPython</tt>，那么这第二种方案也是更好的，因为这样你可以创建一个表而不用去改变已有的代码。在下面一节我们将展示包含这两种方案的一个例子。 <span id="line-468" class="anchor"/><span id="line-469" class="anchor"/><span id="line-470" class="anchor"/></p><p class="line867"><strong>使用<tt>PyGridTableBase</tt>：特定于应用程序（不通用）的子类</strong>
<span id="line-471" class="anchor"/><span id="line-472" class="anchor"/></p><p class="line862">我们的第一个例子将使用<tt>PyGridTableBase</tt>的一个特定于应用程序的子类作为我们的模型。由于我们小熊 <span id="line-473" class="anchor"/>队阵容的相对简单些，所以我们使用它。我们把这些数据组织到一个派生自<tt>PyGridTableBase</tt>的类。我们 <span id="line-474" class="anchor"/>把这些实际的数据配置在一个二维<tt>Python</tt>列表中，并且配置另外的方法来从列表中读。下例5.7展示了生 <span id="line-475"
class="anchor"/>成自一个模型类的小熊队的阵容。 <span id="line-476" class="anchor"/><span id="line-477" class="anchor"/><span id="line-478" class="anchor"/></p><p class="line867"><strong>例5.7</strong> <span id="line-479" class="anchor"/><strong>生成自<tt>PyGridTableBase</tt>模型的一个表</strong> <span id="line-480" class="anchor"/><span id="line-481" class="anchor"/><span id="line-482" class="anchor"/><span id="line-483" class="anchor"/><span id="line-484" class="anchor"/><span id="line-485" class="anchor"/><span
id="line-486" class="anchor"/><span id="line-487" class="anchor"/><span id="line-488" class="anchor"/><span id="line-489" class="anchor"/><span id="line-490" class="anchor"/><span id="line-491" class="anchor"/><span id="line-492" class="anchor"/><span id="line-493" class="anchor"/><span id="line-494" class="anchor"/><span id="line-495" class="anchor"/><span id="line-496" class="anchor"/><span id="line-497" class="anchor"/><span id="line-498" class="anchor"/><span id="line-499" class="anchor"/><span id="line-500"
class="anchor"/><span id="line-501" class="anchor"/><span id="line-502" class="anchor"/><span id="line-503" class="anchor"/><span id="line-504" class="anchor"/><span id="line-505" class="anchor"/><span id="line-506" class="anchor"/><span id="line-507" class="anchor"/><span id="line-508" class="anchor"/><span id="line-509" class="anchor"/><span id="line-510" class="anchor"/><span id="line-511" class="anchor"/><span id="line-512" class="anchor"/><span id="line-513" class="anchor"/><span id="line-514" class="anchor"/><span
id="line-515" class="anchor"/><span id="line-516" class="anchor"/><span id="line-517" class="anchor"/><span id="line-518" class="anchor"/><span id="line-519" class="anchor"/><span id="line-520" class="anchor"/><span id="line-521" class="anchor"/><span id="line-522" class="anchor"/><span id="line-523" class="anchor"/><span id="line-524" class="anchor"/><span id="line-525" class="anchor"/><span id="line-526" class="anchor"/><span id="line-527" class="anchor"/><span id="line-528" class="anchor"/><span id="line-529"
class="anchor"/><span id="line-530" class="anchor"/><span id="line-531" class="anchor"/><span id="line-532" class="anchor"/><span id="line-533" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-1f42f1ef5394f8f9ccddc6f2842cbf1933ebc923_006\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-1f42f1ef5394f8f9ccddc6f2842cbf1933ebc923_006', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-1f42f1ef5394f8f9ccddc6f2842cbf1933ebc923_006" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">import</span> <span class="ID">wx</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="ResWord">import</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span></span>
<span class="line"><span class="LineNumber">   3 </span></span>
<span class="line"><span class="LineNumber">   4 </span><span class="ResWord">class</span> <span class="ID">LineupTable</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">PyGridTableBase</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   5 </span></span>
<span class="line"><span class="LineNumber">   6 </span>        <span class="ID">data</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="Operator">(</span><span class="String">"CF"</span><span class="Operator">,</span> <span class="String">"Bob"</span><span class="Operator">,</span> <span class="String">"Dernier"</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">(</span><span class="String">"2B"</span><span class="Operator">,</span>
<span class="String">"Ryne"</span><span class="Operator">,</span> <span class="String">"Sandberg"</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">   7 </span>                <span class="Operator">(</span><span class="String">"LF"</span><span class="Operator">,</span> <span class="String">"Gary"</span><span class="Operator">,</span> <span class="String">"Matthews"</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">(</span><span class="String">"1B"</span><span class="Operator">,</span> <span class="String">"Leon"</span><span class="Operator">,</span> <span
class="String">"Durham"</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">   8 </span>                <span class="Operator">(</span><span class="String">"RF"</span><span class="Operator">,</span> <span class="String">"Keith"</span><span class="Operator">,</span> <span class="String">"Moreland"</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">(</span><span class="String">"3B"</span><span class="Operator">,</span> <span class="String">"Ron"</span><span class="Operator">,</span> <span
class="String">"Cey"</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">   9 </span>                <span class="Operator">(</span><span class="String">"C"</span><span class="Operator">,</span> <span class="String">"Jody"</span><span class="Operator">,</span> <span class="String">"Davis"</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">(</span><span class="String">"SS"</span><span class="Operator">,</span> <span class="String">"Larry"</span><span class="Operator">,</span> <span
class="String">"Bowa"</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  10 </span>                <span class="Operator">(</span><span class="String">"P"</span><span class="Operator">,</span> <span class="String">"Rick"</span><span class="Operator">,</span> <span class="String">"Sutcliffe"</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  11 </span></span>
<span class="line"><span class="LineNumber">  12 </span>        <span class="ID">colLabels</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="String">"Last"</span><span class="Operator">,</span> <span class="String">"First"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  13 </span></span>
<span class="line"><span class="LineNumber">  14 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  15 </span>                <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">PyGridTableBase</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  16 </span></span>
<span class="line"><span class="LineNumber">  17 </span>        <span class="ResWord">def</span> <span class="ID">GetNumberRows</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  18 </span>                <span class="ResWord">return</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">data</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  19 </span></span>
<span class="line"><span class="LineNumber">  20 </span>        <span class="ResWord">def</span> <span class="ID">GetNumberCols</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  21 </span>                <span class="ResWord">return</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">data</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">)</span> <span class="Operator">-</span> <span class="Number">1</span></span>
<span class="line"><span class="LineNumber">  22 </span></span>
<span class="line"><span class="LineNumber">  23 </span>        <span class="ResWord">def</span> <span class="ID">GetColLabelValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  24 </span>                <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">colLabels</span><span class="Operator">[</span><span class="ID">col</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  25 </span></span>
<span class="line"><span class="LineNumber">  26 </span>        <span class="ResWord">def</span> <span class="ID">GetRowLabelValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  27 </span>                <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">data</span><span class="Operator">[</span><span class="ID">row</span><span class="Operator">]</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  28 </span></span>
<span class="line"><span class="LineNumber">  29 </span>        <span class="ResWord">def</span> <span class="ID">IsEmptyCell</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  30 </span>                <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber">  31 </span></span>
<span class="line"><span class="LineNumber">  32 </span>        <span class="ResWord">def</span> <span class="ID">GetValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  33 </span>                <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">data</span><span class="Operator">[</span><span class="ID">row</span><span class="Operator">]</span><span class="Operator">[</span><span class="ID">col</span> <span class="Operator">+</span> <span class="Number">1</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  34 </span></span>
<span class="line"><span class="LineNumber">  35 </span>        <span class="ResWord">def</span> <span class="ID">SetValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">,</span> <span class="ID">value</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  36 </span>                <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber">  37 </span></span>
<span class="line"><span class="LineNumber">  38 </span><span class="ResWord">class</span> <span class="ID">SimpleGrid</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">Grid</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  39 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  40 </span>                <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">Grid</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span
class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  41 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetTable</span><span class="Operator">(</span><span class="ID">LineupTable</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">)</span> <span class="Comment">#设置表</span></span>
<span class="line"><span class="LineNumber">  42 </span></span>
<span class="line"><span class="LineNumber">  43 </span><span class="ResWord">class</span> <span class="ID">TestFrame</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  44 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  45 </span>                <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span class="String">"A Grid"</span><span
class="Operator">,</span><span class="ID">size</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">275</span><span class="Operator">,</span> <span class="Number">275</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  46 </span>                <span class="ID">grid</span> <span class="Operator">=</span> <span class="ID">SimpleGrid</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  47 </span></span>
<span class="line"><span class="LineNumber">  48 </span><span class="ResWord">if</span> <span class="ID">__name__</span> <span class="Operator">==</span> <span class="String">'__main__'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  49 </span>        <span class="ID">app</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">PySimpleApp</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  50 </span>        <span class="ID">frame</span> <span class="Operator">=</span> <span class="ID">TestFrame</span><span class="Operator">(</span><span class="ID">None</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  51 </span>        <span class="ID">frame</span><span class="Operator">.</span><span class="ID">Show</span><span class="Operator">(</span><span class="ID">True</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  52 </span>        <span class="ID">app</span><span class="Operator">.</span><span class="ID">MainLoop</span><span class="Operator">(</span><span class="Operator">)</span><span class="Text"/></span>
</pre></div><span id="line-534" class="anchor"/><span id="line-535" class="anchor"/><p class="line862">在例5.7中，我们已经定义了所有必须的<tt>PyGridTableBase</tt>方法，并加上了额外的方法<tt>GetColLabelValue()</tt>和<tt>GetRowLabelValue()</tt>。希望你不要对这两个额外的方法感到诧异，这两个额外的方法使得表(<tt>table)</tt>能 <span id="line-536" class="anchor"/>够分别指定行和列的标签。在重构一节中，使用模型类的作用是将数据与显示分开。在本例中，我们已经 <span id="line-537"
class="anchor"/>把数据移入了一个更加结构化的格式，它能够容易地被分离到一个外部文件或资源中（数据库容易被增加到这里）。 <span id="line-538" class="anchor"/><span id="line-539" class="anchor"/><span id="line-540" class="anchor"/></p><p class="line867"><strong>使用<tt>PyGridTableBase</tt>：一个通用的例子</strong> <span id="line-541" class="anchor"/><span id="line-542" class="anchor"/></p><p class="line862">实际上，上面的例子很接近一个通用的能够读任何二维<tt>Python</tt>列表的表了。下列5.8展示这通用的模型的
<span id="line-543" class="anchor"/>外观： <span id="line-544" class="anchor"/><span id="line-545" class="anchor"/><span id="line-546" class="anchor"/></p><p class="line867"><strong>例5.8</strong> <span id="line-547" class="anchor"/><strong>一个关于二维列表的通用的表</strong> <span id="line-548" class="anchor"/><span id="line-549" class="anchor"/><span id="line-550" class="anchor"/><span id="line-551" class="anchor"/><span id="line-552" class="anchor"/><span id="line-553" class="anchor"/><span id="line-554"
class="anchor"/><span id="line-555" class="anchor"/><span id="line-556" class="anchor"/><span id="line-557" class="anchor"/><span id="line-558" class="anchor"/><span id="line-559" class="anchor"/><span id="line-560" class="anchor"/><span id="line-561" class="anchor"/><span id="line-562" class="anchor"/><span id="line-563" class="anchor"/><span id="line-564" class="anchor"/><span id="line-565" class="anchor"/><span id="line-566" class="anchor"/><span id="line-567" class="anchor"/><span id="line-568"
class="anchor"/><span id="line-569" class="anchor"/><span id="line-570" class="anchor"/><span id="line-571" class="anchor"/><span id="line-572" class="anchor"/><span id="line-573" class="anchor"/><span id="line-574" class="anchor"/><span id="line-575" class="anchor"/><span id="line-576" class="anchor"/><span id="line-577" class="anchor"/><span id="line-578" class="anchor"/><span id="line-579" class="anchor"/><span id="line-580" class="anchor"/><span id="line-581" class="anchor"/><span id="line-582"
class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-23e268006fd5477cfda13e3b5a80a727b7591e34_007\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-23e268006fd5477cfda13e3b5a80a727b7591e34_007', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-23e268006fd5477cfda13e3b5a80a727b7591e34_007" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">import</span> <span class="ID">wx</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="ResWord">import</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span></span>
<span class="line"><span class="LineNumber">   3 </span></span>
<span class="line"><span class="LineNumber">   4 </span><span class="ResWord">class</span> <span class="ID">GenericTable</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">PyGridTableBase</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   5 </span></span>
<span class="line"><span class="LineNumber">   6 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">data</span><span class="Operator">,</span> <span class="ID">rowLabels</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">,</span> <span class="ID">colLabels</span><span class="Operator">=</span><span
class="ID">None</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   7 </span>        <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">PyGridTableBase</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   8 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">data</span> <span class="Operator">=</span> <span class="ID">data</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">rowLabels</span> <span class="Operator">=</span> <span class="ID">rowLabels</span></span>
<span class="line"><span class="LineNumber">  10 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">colLabels</span> <span class="Operator">=</span> <span class="ID">colLabels</span></span>
<span class="line"><span class="LineNumber">  11 </span></span>
<span class="line"><span class="LineNumber">  12 </span>    <span class="ResWord">def</span> <span class="ID">GetNumberRows</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  13 </span>        <span class="ResWord">return</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">data</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  14 </span></span>
<span class="line"><span class="LineNumber">  15 </span>    <span class="ResWord">def</span> <span class="ID">GetNumberCols</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  16 </span>        <span class="ResWord">return</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">data</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  17 </span></span>
<span class="line"><span class="LineNumber">  18 </span>    <span class="ResWord">def</span> <span class="ID">GetColLabelValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  19 </span>        <span class="ResWord">if</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">colLabels</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  20 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">colLabels</span><span class="Operator">[</span><span class="ID">col</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  21 </span></span>
<span class="line"><span class="LineNumber">  22 </span>    <span class="ResWord">def</span> <span class="ID">GetRowLabelValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  23 </span>        <span class="ResWord">if</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">rowLabels</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  24 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">rowLabels</span><span class="Operator">[</span><span class="ID">row</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  25 </span></span>
<span class="line"><span class="LineNumber">  26 </span>    <span class="ResWord">def</span> <span class="ID">IsEmptyCell</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  27 </span>        <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber">  28 </span></span>
<span class="line"><span class="LineNumber">  29 </span>    <span class="ResWord">def</span> <span class="ID">GetValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  30 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">data</span><span class="Operator">[</span><span class="ID">row</span><span class="Operator">]</span><span class="Operator">[</span><span class="ID">col</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  31 </span></span>
<span class="line"><span class="LineNumber">  32 </span>    <span class="ResWord">def</span> <span class="ID">SetValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">,</span> <span class="ID">value</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  33 </span>        <span class="ResWord">pass</span><span class="Text"/></span>
</pre></div><span id="line-583" class="anchor"/><p class="line867"><tt>GenericTable</tt>类要求一个数据的二维列表和一个可选的行和列标签列表。这个类适合被导入任何<tt>wxPython</tt> <span id="line-584" class="anchor"/>程序中。使用一个做了微小改变的格式，我们现在可以使用这通用的表来显示阵容，如下例5.9所示： <span id="line-585" class="anchor"/><span id="line-586" class="anchor"/><span id="line-587" class="anchor"/></p><p class="line867"><strong>例5.9</strong> <span id="line-588"
class="anchor"/><strong>使用这通用的表来显示阵容</strong> <span id="line-589" class="anchor"/><span id="line-590" class="anchor"/><span id="line-591" class="anchor"/><span id="line-592" class="anchor"/><span id="line-593" class="anchor"/><span id="line-594" class="anchor"/><span id="line-595" class="anchor"/><span id="line-596" class="anchor"/><span id="line-597" class="anchor"/><span id="line-598" class="anchor"/><span id="line-599" class="anchor"/><span id="line-600" class="anchor"/><span
id="line-601" class="anchor"/><span id="line-602" class="anchor"/><span id="line-603" class="anchor"/><span id="line-604" class="anchor"/><span id="line-605" class="anchor"/><span id="line-606" class="anchor"/><span id="line-607" class="anchor"/><span id="line-608" class="anchor"/><span id="line-609" class="anchor"/><span id="line-610" class="anchor"/><span id="line-611" class="anchor"/><span id="line-612" class="anchor"/><span id="line-613" class="anchor"/><span id="line-614"
class="anchor"/><span id="line-615" class="anchor"/><span id="line-616" class="anchor"/><span id="line-617" class="anchor"/><span id="line-618" class="anchor"/><span id="line-619" class="anchor"/><span id="line-620" class="anchor"/><span id="line-621" class="anchor"/><span id="line-622" class="anchor"/><span id="line-623" class="anchor"/><span id="line-624" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-17cdf455cedba3d79c7b0e86382d05fc610a8458_008\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-17cdf455cedba3d79c7b0e86382d05fc610a8458_008', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-17cdf455cedba3d79c7b0e86382d05fc610a8458_008" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">import</span> <span class="ID">wx</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="ResWord">import</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span></span>
<span class="line"><span class="LineNumber">   3 </span><span class="ResWord">import</span> <span class="ID">generictable</span></span>
<span class="line"><span class="LineNumber">   4 </span></span>
<span class="line"><span class="LineNumber">   5 </span></span>
<span class="line"><span class="LineNumber">   6 </span><span class="ID">data</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="Operator">(</span><span class="String">"Bob"</span><span class="Operator">,</span> <span class="String">"Dernier"</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">(</span><span class="String">"Ryne"</span><span class="Operator">,</span> <span
class="String">"Sandberg"</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">   7 </span>        <span class="Operator">(</span><span class="String">"Gary"</span><span class="Operator">,</span> <span class="String">"Matthews"</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">(</span><span class="String">"Leon"</span><span class="Operator">,</span> <span class="String">"Durham"</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">   8 </span>        <span class="Operator">(</span><span class="String">"Keith"</span><span class="Operator">,</span> <span class="String">"Moreland"</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">(</span><span class="String">"Ron"</span><span class="Operator">,</span> <span class="String">"Cey"</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="Operator">(</span><span class="String">"Jody"</span><span class="Operator">,</span> <span class="String">"Davis"</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">(</span><span class="String">"Larry"</span><span class="Operator">,</span> <span class="String">"Bowa"</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  10 </span>        <span class="Operator">(</span><span class="String">"Rick"</span><span class="Operator">,</span> <span class="String">"Sutcliffe"</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  11 </span></span>
<span class="line"><span class="LineNumber">  12 </span><span class="ID">colLabels</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="String">"Last"</span><span class="Operator">,</span> <span class="String">"First"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  13 </span><span class="ID">rowLabels</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="String">"CF"</span><span class="Operator">,</span> <span class="String">"2B"</span><span class="Operator">,</span> <span class="String">"LF"</span><span class="Operator">,</span> <span class="String">"1B"</span><span class="Operator">,</span> <span class="String">"RF"</span><span class="Operator">,</span> <span
class="String">"3B"</span><span class="Operator">,</span> <span class="String">"C"</span><span class="Operator">,</span> <span class="String">"SS"</span><span class="Operator">,</span> <span class="String">"P"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  14 </span></span>
<span class="line"><span class="LineNumber">  15 </span></span>
<span class="line"><span class="LineNumber">  16 </span><span class="ResWord">class</span> <span class="ID">SimpleGrid</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">Grid</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  17 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  18 </span>        <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">Grid</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span
class="Number">1</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  19 </span>        <span class="ID">tableBase</span> <span class="Operator">=</span> <span class="ID">generictable</span><span class="Operator">.</span><span class="ID">GenericTable</span><span class="Operator">(</span><span class="ID">data</span><span class="Operator">,</span> <span class="ID">rowLabels</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  20 </span>                <span class="ID">colLabels</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  21 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">SetTable</span><span class="Operator">(</span><span class="ID">tableBase</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  22 </span></span>
<span class="line"><span class="LineNumber">  23 </span><span class="ResWord">class</span> <span class="ID">TestFrame</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  24 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  25 </span>        <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span
class="String">"A Grid"</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  26 </span>                <span class="ID">size</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">275</span><span class="Operator">,</span> <span class="Number">275</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  27 </span>        <span class="ID">grid</span> <span class="Operator">=</span> <span class="ID">SimpleGrid</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  28 </span></span>
<span class="line"><span class="LineNumber">  29 </span><span class="ResWord">if</span> <span class="ID">__name__</span> <span class="Operator">==</span> <span class="String">'__main__'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  30 </span>    <span class="ID">app</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">PySimpleApp</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  31 </span>    <span class="ID">frame</span> <span class="Operator">=</span> <span class="ID">TestFrame</span><span class="Operator">(</span><span class="ID">None</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  32 </span>    <span class="ID">frame</span><span class="Operator">.</span><span class="ID">Show</span><span class="Operator">(</span><span class="ID">True</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  33 </span>    <span class="ID">app</span><span class="Operator">.</span><span class="ID">MainLoop</span><span class="Operator">(</span><span class="Operator">)</span><span class="Text"/></span>
</pre></div><span id="line-625" class="anchor"/><span id="line-626" class="anchor"/><p class="line867"><strong>使用<tt>PyGridTableBase</tt>：一个独立的模型类</strong> <span id="line-627" class="anchor"/><span id="line-628" class="anchor"/></p><p class="line862">至于避免重复性，有另一种使用<tt>PyGridTableBase</tt>的方法值得在这展示给大家。这就是我们早先提到的第 <span id="line-629"
class="anchor"/>二种方案，数据在一个单独的模型类中，通过<tt>PyGridTableBase</tt>来访问。<tt>Python</tt>的自我检查功能在这是非 <span id="line-630" class="anchor"/>常有用的，使你能够在每列显示一个属性的列表，然后使用内建函数<tt>getattr()</tt>去获取实际的值。在这种 <span id="line-631" class="anchor"/>情况下，模型要求一个元素的列表。在<tt>wxPython</tt>中，使用单独的模型对象结构化你的程序有一个大的优势 <span id="line-632"
class="anchor"/>。在通常的情形下，对于一个<tt>grid</tt>，你只能调用<tt>SetTable()</tt>一次，如果你想去改变表，你需要创建一个新 <span id="line-633" class="anchor"/>的<tt>grid</tt>，那是烦人的。然而，在接下来的例子中，你的<tt>PyGridTableBase</tt>仅存储了对于你的实际数据类的 <span id="line-634" class="anchor"/>实例的引用，这样一来，以后你就只需通过改变表中基本的数据对象，就可以更新表中的数据为新的数据 <span id="line-635" class="anchor"/>了。 <span id="line-636"
class="anchor"/><span id="line-637" class="anchor"/></p><p class="line862">下例5.10展示使用了关于阵容条目的单独的数据类的<tt>PyGridTableBase</tt>。我们省去了框架的另一列表和数据 <span id="line-638" class="anchor"/>创建，它们是与前一例子十分类似的。 <span id="line-639" class="anchor"/><span id="line-640" class="anchor"/><span id="line-641" class="anchor"/></p><p class="line867"><strong>例5.10</strong> <span id="line-642"
class="anchor"/><strong>使用了一个自定义的数据类的阵容显示表</strong> <span id="line-643" class="anchor"/><span id="line-644" class="anchor"/><span id="line-645" class="anchor"/><span id="line-646" class="anchor"/><span id="line-647" class="anchor"/><span id="line-648" class="anchor"/><span id="line-649" class="anchor"/><span id="line-650" class="anchor"/><span id="line-651" class="anchor"/><span id="line-652" class="anchor"/><span id="line-653" class="anchor"/><span
id="line-654" class="anchor"/><span id="line-655" class="anchor"/><span id="line-656" class="anchor"/><span id="line-657" class="anchor"/><span id="line-658" class="anchor"/><span id="line-659" class="anchor"/><span id="line-660" class="anchor"/><span id="line-661" class="anchor"/><span id="line-662" class="anchor"/><span id="line-663" class="anchor"/><span id="line-664" class="anchor"/><span id="line-665" class="anchor"/><span id="line-666" class="anchor"/><span
id="line-667" class="anchor"/><span id="line-668" class="anchor"/><span id="line-669" class="anchor"/><span id="line-670" class="anchor"/><span id="line-671" class="anchor"/><span id="line-672" class="anchor"/><span id="line-673" class="anchor"/><span id="line-674" class="anchor"/><span id="line-675" class="anchor"/><span id="line-676" class="anchor"/><span id="line-677" class="anchor"/><span id="line-678" class="anchor"/><span id="line-679" class="anchor"/><span
id="line-680" class="anchor"/><span id="line-681" class="anchor"/><span id="line-682" class="anchor"/><span id="line-683" class="anchor"/><span id="line-684" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-23bb41b259c1bdacfc91571840e2c8830c833371_009\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-23bb41b259c1bdacfc91571840e2c8830c833371_009', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-23bb41b259c1bdacfc91571840e2c8830c833371_009" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">import</span> <span class="ID">wx</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="ResWord">import</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span></span>
<span class="line"><span class="LineNumber">   3 </span></span>
<span class="line"><span class="LineNumber">   4 </span><span class="ResWord">class</span> <span class="ID">LineupEntry</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   5 </span></span>
<span class="line"><span class="LineNumber">   6 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">,</span> <span class="ID">first</span><span class="Operator">,</span> <span class="ID">last</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   7 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">pos</span> <span class="Operator">=</span> <span class="ID">pos</span></span>
<span class="line"><span class="LineNumber">   8 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">first</span> <span class="Operator">=</span> <span class="ID">first</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">last</span> <span class="Operator">=</span> <span class="ID">last</span></span>
<span class="line"><span class="LineNumber">  10 </span></span>
<span class="line"><span class="LineNumber">  11 </span><span class="ResWord">class</span> <span class="ID">LineupTable</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">PyGridTableBase</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  12 </span></span>
<span class="line"><span class="LineNumber">  13 </span>    <span class="ID">colLabels</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="String">"First"</span><span class="Operator">,</span> <span class="String">"Last"</span><span class="Operator">)</span> <span class="Comment"># 列标签</span></span>
<span class="line"><span class="LineNumber">  14 </span>    <span class="ID">colAttrs</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="String">"first"</span><span class="Operator">,</span> <span class="String">"last"</span><span class="Operator">)</span> <span class="Comment">#1 属性名</span></span>
<span class="line"><span class="LineNumber">  15 </span></span>
<span class="line"><span class="LineNumber">  16 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">entries</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#2 初始化模型</span></span>
<span class="line"><span class="LineNumber">  17 </span>        <span class="ID">wx</span><span class="Operator">.</span><span class="ID">grid</span><span class="Operator">.</span><span class="ID">PyGridTableBase</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  18 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">entries</span> <span class="Operator">=</span> <span class="ID">entries</span></span>
<span class="line"><span class="LineNumber">  19 </span></span>
<span class="line"><span class="LineNumber">  20 </span>    <span class="ResWord">def</span> <span class="ID">GetNumberRows</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  21 </span>        <span class="ResWord">return</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">entries</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  22 </span></span>
<span class="line"><span class="LineNumber">  23 </span>    <span class="ResWord">def</span> <span class="ID">GetNumberCols</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  24 </span>        <span class="ResWord">return</span> <span class="Number">2</span></span>
<span class="line"><span class="LineNumber">  25 </span></span>
<span class="line"><span class="LineNumber">  26 </span>    <span class="ResWord">def</span> <span class="ID">GetColLabelValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  27 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">colLabels</span><span class="Operator">[</span><span class="ID">col</span><span class="Operator">]</span> <span class="Comment">#读列标签</span></span>
<span class="line"><span class="LineNumber">  28 </span></span>
<span class="line"><span class="LineNumber">  29 </span>    <span class="ResWord">def</span> <span class="ID">GetRowLabelValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  30 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">entries</span><span class="Operator">[</span><span class="ID">row</span><span class="Operator">]</span><span class="Operator">.</span><span class="ID">pos</span> <span class="Comment">#3 读行标签</span></span>
<span class="line"><span class="LineNumber">  31 </span></span>
<span class="line"><span class="LineNumber">  32 </span>    <span class="ResWord">def</span> <span class="ID">IsEmptyCell</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  33 </span>        <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber">  34 </span></span>
<span class="line"><span class="LineNumber">  35 </span>    <span class="ResWord">def</span> <span class="ID">GetValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  36 </span>        <span class="ID">entry</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">entries</span><span class="Operator">[</span><span class="ID">row</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  37 </span>        <span class="ResWord">return</span> <span class="ID">getattr</span><span class="Operator">(</span><span class="ID">entry</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">colAttrs</span><span class="Operator">[</span><span class="ID">col</span><span class="Operator">]</span><span class="Operator">)</span> <span class="Comment">#4
读属性值</span></span>
<span class="line"><span class="LineNumber">  38 </span></span>
<span class="line"><span class="LineNumber">  39 </span>    <span class="ResWord">def</span> <span class="ID">SetValue</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">row</span><span class="Operator">,</span> <span class="ID">col</span><span class="Operator">,</span> <span class="ID">value</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  40 </span>        <span class="ResWord">pass</span><span class="Text"/></span>
</pre></div><span id="line-685" class="anchor"/><p class="line874">说明： <span id="line-686" class="anchor"/><span id="line-687" class="anchor"/><span id="line-688" class="anchor"/></p><p class="line867"><strong>#1</strong>：这个列表包含了一些属性，它们被引用去按列地显示每列的值。 <span id="line-689" class="anchor"/><span id="line-690" class="anchor"/></p><p
class="line867"><strong>#2</strong>：这个模型要求一个条目的列表，每个条目都是<tt>LineupEntry</tt>的一个实例。（这里我们没有做任何的错误检查）。 <span id="line-691" class="anchor"/><span id="line-692" class="anchor"/></p><p class="line867"><strong>#3</strong>：要得到行头的标签，我们查看条目的<tt>pos</tt>属性。 <span id="line-693" class="anchor"/><span id="line-694" class="anchor"/></p><p
class="line867"><strong>#4</strong>：第一步是根据行来得到正确的条目。所要求的属性来自于#1中的列表，然后<tt>getattr()</tt>被用来引用实际的值。这个机制是可扩展的，即使是在你不知道该名字是否引用一个属性或方法的情况下，你也可以通 <span id="line-695" class="anchor"/>过检查 <tt>object</tt> . <tt>attribute</tt> 来看是否其可调用。如果可调用，那么使用通常的<tt>Python</tt>函数语法来调用它 <span id="line-696" class="anchor"/>，并返回它的值。 <span id="line-697"
class="anchor"/><span id="line-698" class="anchor"/></p><p class="line867"><tt>grid</tt>类是<tt>wxPython</tt>已有的一个有价值的模型组件来帮助你结构化你的应用程序的一个例子。下一节我们将 <span id="line-699" class="anchor"/>讨论如何为别的<tt>wxPython</tt>对象创建模型组件。 <span id="line-700" class="anchor"/><span id="line-701" class="anchor"/><span id="line-702" class="anchor"/><span id="line-703" class="anchor"/></p><p class="line867">
</p><h3 id="head-a6da2733890a701b0c0bf336863a86cb9c72c28e">1.2.3. 自定义模型</h3>
<span id="line-704" class="anchor"/><span id="line-705" class="anchor"/><span id="line-706" class="anchor"/><p class="line874">创建你的模型对象所基于的基本思想是简单的。首先构造你的数据类而不要担心它们将如何被显示。然后 <span id="line-707" class="anchor"/>为数据类作一个公共接口，该接口对显示对象是能够被访问的。很明显，这个工程的大小和复杂性将决定 <span id="line-708"
class="anchor"/>这个公共声明的形式如何。在一个小的工程中，使用简单的对象，可能足够做简单的事件和使视图对象能 <span id="line-709" class="anchor"/>够访问该模型的属性。在一个更复杂的对象中，对于这种使用你可能想定义特殊的方法，或创建一个分离 <span id="line-710" class="anchor"/>的模型类，该类是视图唯一看到的东西（正如我们在例5.10所做的）。 <span id="line-711" class="anchor"/><span id="line-712" class="anchor"/></p><p
class="line874">为了使视图由于模型中的改变而被得到通知，你也需要某种机制。例5.11展示了一个简单的——一个抽象 <span id="line-713" class="anchor"/>的基类，你可以用它作为你的模型类的双亲。你可以把这看成<tt>PyGridTableBase</tt>用于当显示不是一个网格 <span id="line-714" class="anchor"/>(<tt>grid)</tt>时的一个类似情况。 <span id="line-715" class="anchor"/><span id="line-716" class="anchor"/><span id="line-717" class="anchor"/></p><p
class="line867"><strong>例5.11</strong> <span id="line-718" class="anchor"/><strong>用于更新视图的一个自定义的模型</strong> <span id="line-719" class="anchor"/><span id="line-720" class="anchor"/><span id="line-721" class="anchor"/><span id="line-722" class="anchor"/><span id="line-723" class="anchor"/><span id="line-724" class="anchor"/><span id="line-725" class="anchor"/><span id="line-726" class="anchor"/><span id="line-727" class="anchor"/><span
id="line-728" class="anchor"/><span id="line-729" class="anchor"/><span id="line-730" class="anchor"/><span id="line-731" class="anchor"/><span id="line-732" class="anchor"/><span id="line-733" class="anchor"/><span id="line-734" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-1bfaefacb570f4e558d2688cbee8fa649708b7fb_010\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-1bfaefacb570f4e558d2688cbee8fa649708b7fb_010', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-1bfaefacb570f4e558d2688cbee8fa649708b7fb_010" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">class</span> <span class="ID">AbstractModel</span><span class="Operator">(</span><span class="ID">object</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   2 </span></span>
<span class="line"><span class="LineNumber">   3 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   4 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">listeners</span> <span class="Operator">=</span> <span class="Operator">[</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">   5 </span></span>
<span class="line"><span class="LineNumber">   6 </span>        <span class="ResWord">def</span> <span class="ID">addListener</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">listenerFunc</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   7 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">listeners</span><span class="Operator">.</span><span class="ID">append</span><span class="Operator">(</span><span class="ID">listenerFunc</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   8 </span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ResWord">def</span> <span class="ID">removeListener</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">listenerFunc</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  10 </span>                <span class="ID">self</span><span class="Operator">.</span><span class="ID">listeners</span><span class="Operator">.</span><span class="ID">remove</span><span class="Operator">(</span><span class="ID">listenerFunc</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  11 </span></span>
<span class="line"><span class="LineNumber">  12 </span>        <span class="ResWord">def</span> <span class="ID">update</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  13 </span>                <span class="ResWord">for</span> <span class="ID">eachFunc</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">listeners</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  14 </span>                        <span class="ID">eachFunc</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Text"/></span>
</pre></div><span id="line-735" class="anchor"/><span id="line-736" class="anchor"/><p class="line862">我们这里的<tt>listener</tt>应该是可调用的对象，它需要<tt>self</tt>作为参数（<tt>eachFunc(self)</tt>）——很明显，<tt>self</tt>的 <span id="line-737" class="anchor"/>实际的类可以是不同的，因此你的<tt>listenter</tt>很灵活了。同样，我们已经将<tt>AbstractModel</tt>配置成一个 <span id="line-738"
class="anchor"/><tt>Python</tt>的新型的类，事实上它是<tt>object</tt>的子类。因此本例要求<tt>Python</tt>的版本是<tt>Python2.2</tt>或更高。 <span id="line-739" class="anchor"/><span id="line-740" class="anchor"/></p><p class="line874">我们如何使用这个抽象的类呢？图5.4显示了一个新的窗口，类似于我们本章早先讲重构时所显示的窗口 <span id="line-741" class="anchor"/>。这个窗口简单。其中文本框是只读的。敲击上面的任一按钮将在文本框中显示相应的字符。
<span id="line-742" class="anchor"/><span id="line-743" class="anchor"/></p><p class="line867"><img title="attachment:w5.4.gif" src="/moin/WxPythonInAction/ChapterFive?action=AttachFile&amp;do=get&amp;target=w5.4.gif" class="attachment"/> <span id="line-744" class="anchor"/><span id="line-745" class="anchor"/></p><p class="line862">显示这个窗口的程序使用了一个简单的<tt>MVC</tt>结构。按钮的处理器方法引起这个模型中的变化，模型中的更 <span
id="line-746" class="anchor"/>新导致文本域的改变。例5.12展示了这个细节。 <span id="line-747" class="anchor"/><span id="line-748" class="anchor"/><span id="line-749" class="anchor"/></p><p class="line867"><strong>例5.12</strong> <span id="line-750" class="anchor"/><span id="line-751" class="anchor"/><span id="line-752" class="anchor"/><span id="line-753" class="anchor"/><span id="line-754" class="anchor"/><span id="line-755"
class="anchor"/><span id="line-756" class="anchor"/><span id="line-757" class="anchor"/><span id="line-758" class="anchor"/><span id="line-759" class="anchor"/><span id="line-760" class="anchor"/><span id="line-761" class="anchor"/><span id="line-762" class="anchor"/><span id="line-763" class="anchor"/><span id="line-764" class="anchor"/><span id="line-765" class="anchor"/><span id="line-766" class="anchor"/><span id="line-767"
class="anchor"/><span id="line-768" class="anchor"/><span id="line-769" class="anchor"/><span id="line-770" class="anchor"/><span id="line-771" class="anchor"/><span id="line-772" class="anchor"/><span id="line-773" class="anchor"/><span id="line-774" class="anchor"/><span id="line-775" class="anchor"/><span id="line-776" class="anchor"/><span id="line-777" class="anchor"/><span id="line-778" class="anchor"/><span id="line-779"
class="anchor"/><span id="line-780" class="anchor"/><span id="line-781" class="anchor"/><span id="line-782" class="anchor"/><span id="line-783" class="anchor"/><span id="line-784" class="anchor"/><span id="line-785" class="anchor"/><span id="line-786" class="anchor"/><span id="line-787" class="anchor"/><span id="line-788" class="anchor"/><span id="line-789" class="anchor"/><span id="line-790" class="anchor"/><span id="line-791"
class="anchor"/><span id="line-792" class="anchor"/><span id="line-793" class="anchor"/><span id="line-794" class="anchor"/><span id="line-795" class="anchor"/><span id="line-796" class="anchor"/><span id="line-797" class="anchor"/><span id="line-798" class="anchor"/><span id="line-799" class="anchor"/><span id="line-800" class="anchor"/><span id="line-801" class="anchor"/><span id="line-802" class="anchor"/><span id="line-803"
class="anchor"/><span id="line-804" class="anchor"/><span id="line-805" class="anchor"/><span id="line-806" class="anchor"/><span id="line-807" class="anchor"/><span id="line-808" class="anchor"/><span id="line-809" class="anchor"/><span id="line-810" class="anchor"/><span id="line-811" class="anchor"/><span id="line-812" class="anchor"/><span id="line-813" class="anchor"/><span id="line-814" class="anchor"/><span id="line-815"
class="anchor"/><span id="line-816" class="anchor"/><span id="line-817" class="anchor"/><span id="line-818" class="anchor"/><span id="line-819" class="anchor"/><span id="line-820" class="anchor"/><span id="line-821" class="anchor"/><span id="line-822" class="anchor"/><span id="line-823" class="anchor"/><span id="line-824" class="anchor"/><span id="line-825" class="anchor"/><span id="line-826" class="anchor"/><span id="line-827"
class="anchor"/><span id="line-828" class="anchor"/><span id="line-829" class="anchor"/><span id="line-830" class="anchor"/><span id="line-831" class="anchor"/><span id="line-832" class="anchor"/><span id="line-833" class="anchor"/><span id="line-834" class="anchor"/><span id="line-835" class="anchor"/><span id="line-836" class="anchor"/><span id="line-837" class="anchor"/><span id="line-838" class="anchor"/><span id="line-839"
class="anchor"/><span id="line-840" class="anchor"/><span id="line-841" class="anchor"/><span id="line-842" class="anchor"/><span id="line-843" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-77749a74107291c3c86aadc81d55ccc8dad66df2_011\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-77749a74107291c3c86aadc81d55ccc8dad66df2_011', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-77749a74107291c3c86aadc81d55ccc8dad66df2_011" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="Comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="Comment"/></span>
<span class="line"><span class="LineNumber">   3 </span><span class="ResWord">import</span> <span class="ID">wx</span></span>
<span class="line"><span class="LineNumber">   4 </span><span class="ResWord">import</span> <span class="ID">abstractmodel</span></span>
<span class="line"><span class="LineNumber">   5 </span></span>
<span class="line"><span class="LineNumber">   6 </span><span class="ResWord">class</span> <span class="ID">SimpleName</span><span class="Operator">(</span><span class="ID">abstractmodel</span><span class="Operator">.</span><span class="ID">AbstractModel</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   7 </span></span>
<span class="line"><span class="LineNumber">   8 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">first</span><span class="Operator">=</span><span class="String">""</span><span class="Operator">,</span> <span class="ID">last</span><span class="Operator">=</span><span class="String">""</span><span
class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ID">abstractmodel</span><span class="Operator">.</span><span class="ID">AbstractModel</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  10 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">set</span><span class="Operator">(</span><span class="ID">first</span><span class="Operator">,</span> <span class="ID">last</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  11 </span></span>
<span class="line"><span class="LineNumber">  12 </span>    <span class="ResWord">def</span> <span class="ID">set</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">first</span><span class="Operator">,</span> <span class="ID">last</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  13 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">first</span> <span class="Operator">=</span> <span class="ID">first</span></span>
<span class="line"><span class="LineNumber">  14 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">last</span> <span class="Operator">=</span> <span class="ID">last</span></span>
<span class="line"><span class="LineNumber">  15 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">update</span><span class="Operator">(</span><span class="Operator">)</span>   <span class="Comment">#1 更新</span></span>
<span class="line"><span class="LineNumber">  16 </span></span>
<span class="line"><span class="LineNumber">  17 </span><span class="ResWord">class</span> <span class="ID">ModelExample</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  18 </span></span>
<span class="line"><span class="LineNumber">  19 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">id</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  20 </span>        <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Frame</span><span class="Operator">.</span><span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">id</span><span class="Operator">,</span> <span
class="String">'Flintstones'</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  21 </span>                <span class="ID">size</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">340</span><span class="Operator">,</span> <span class="Number">200</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  22 </span>        <span class="ID">panel</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Panel</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  23 </span>        <span class="ID">panel</span><span class="Operator">.</span><span class="ID">SetBackgroundColour</span><span class="Operator">(</span><span class="String">"White"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  24 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_CLOSE</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnCloseWindow</span><span
class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  25 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">textFields</span> <span class="Operator">=</span> <span class="Operator">{</span><span class="Operator">}</span></span>
<span class="line"><span class="LineNumber">  26 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">createTextFields</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  27 </span><span class="Comment">#-------------------------------</span></span>
<span class="line"><span class="LineNumber">  28 </span><span class="Comment"/>    <span class="Comment">#2 创建模型</span></span>
<span class="line"><span class="LineNumber">  29 </span><span class="Comment"/>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">model</span> <span class="Operator">=</span> <span class="ID">SimpleName</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  30 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">model</span><span class="Operator">.</span><span class="ID">addListener</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">OnUpdate</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  31 </span>        <span class="Comment">#-------------------------------</span></span>
<span class="line"><span class="LineNumber">  32 </span><span class="Comment"/>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">createButtonBar</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  33 </span></span>
<span class="line"><span class="LineNumber">  34 </span>    <span class="ResWord">def</span> <span class="ID">buttonData</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  35 </span>        <span class="ResWord">return</span> <span class="Operator">(</span><span class="Operator">(</span><span class="String">"Fredify"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnFred</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  36 </span>                <span class="Operator">(</span><span class="String">"Wilmafy"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnWilma</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  37 </span>                <span class="Operator">(</span><span class="String">"Barnify"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnBarney</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  38 </span>                <span class="Operator">(</span><span class="String">"Bettify"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">OnBetty</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  39 </span></span>
<span class="line"><span class="LineNumber">  40 </span>    <span class="ResWord">def</span> <span class="ID">createButtonBar</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">panel</span><span class="Operator">,</span> <span class="ID">yPos</span> <span class="Operator">=</span> <span class="Number">0</span><span class="Operator">)</span><span
class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  41 </span>        <span class="ID">xPos</span> <span class="Operator">=</span> <span class="Number">0</span></span>
<span class="line"><span class="LineNumber">  42 </span>        <span class="ResWord">for</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachHandler</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">buttonData</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  43 </span>            <span class="ID">pos</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="ID">xPos</span><span class="Operator">,</span> <span class="ID">yPos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  44 </span>            <span class="ID">button</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachHandler</span><span
class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  45 </span>            <span class="ID">xPos</span> <span class="Operator">+=</span> <span class="ID">button</span><span class="Operator">.</span><span class="ID">GetSize</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">width</span></span>
<span class="line"><span class="LineNumber">  46 </span></span>
<span class="line"><span class="LineNumber">  47 </span>    <span class="ResWord">def</span> <span class="ID">buildOneButton</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">parent</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">handler</span><span class="Operator">,</span> <span
class="ID">pos</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">0</span><span class="Operator">,</span><span class="Number">0</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  48 </span>        <span class="ID">button</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">Button</span><span class="Operator">(</span><span class="ID">parent</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">,</span> <span
class="ID">label</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  49 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Bind</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">EVT_BUTTON</span><span class="Operator">,</span> <span class="ID">handler</span><span class="Operator">,</span> <span class="ID">button</span><span
class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  50 </span>        <span class="ResWord">return</span> <span class="ID">button</span></span>
<span class="line"><span class="LineNumber">  51 </span></span>
<span class="line"><span class="LineNumber">  52 </span>    <span class="ResWord">def</span> <span class="ID">textFieldData</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  53 </span>        <span class="ResWord">return</span> <span class="Operator">(</span><span class="Operator">(</span><span class="String">"First Name"</span><span class="Operator">,</span> <span class="Operator">(</span><span class="Number">10</span><span class="Operator">,</span> <span class="Number">50</span><span class="Operator">)</span><span class="Operator">)</span><span
class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  54 </span>                <span class="Operator">(</span><span class="String">"Last Name"</span><span class="Operator">,</span> <span class="Operator">(</span><span class="Number">10</span><span class="Operator">,</span> <span class="Number">80</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  55 </span></span>
<span class="line"><span class="LineNumber">  56 </span>    <span class="ResWord">def</span> <span class="ID">createTextFields</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">panel</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  57 </span>        <span class="ResWord">for</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachPos</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">textFieldData</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  58 </span>            <span class="ID">self</span><span class="Operator">.</span><span class="ID">createCaptionedText</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">eachLabel</span><span class="Operator">,</span> <span class="ID">eachPos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  59 </span></span>
<span class="line"><span class="LineNumber">  60 </span>    <span class="ResWord">def</span> <span class="ID">createCaptionedText</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">panel</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span><span
class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  61 </span>        <span class="ID">static</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">StaticText</span><span class="Operator">(</span><span class="ID">panel</span><span class="Operator">,</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">NewId</span><span class="Operator">(</span><span
class="Operator">)</span><span class="Operator">,</span> <span class="ID">label</span><span class="Operator">,</span> <span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  62 </span>        <span class="ID">static</span><span class="Operator">.</span><span class="ID">SetBackgroundColour</span><span class="Operator">(</span><span class="String">"White"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  63 </span>        <span class="ID">textPos</span> <span class="Operator">=</span> <span class="Operator">(</span><span class="ID">pos</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span> <span class="Operator">+</span> <span class="Number">75</span><span class="Operator">,</span> <span class="ID">pos</span><span
class="Operator">[</span><span class="Number">1</span><span class="Operator">]</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  64 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">textFields</span><span class="Operator">[</span><span class="ID">label</span><span class="Operator">]</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">TextCtrl</span><span class="Operator">(</span><span
class="ID">panel</span><span class="Operator">,</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">NewId</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  65 </span>                <span class="String">""</span><span class="Operator">,</span> <span class="ID">size</span><span class="Operator">=</span><span class="Operator">(</span><span class="Number">100</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span><span class="Operator">,</span> <span
class="ID">pos</span><span class="Operator">=</span><span class="ID">textPos</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  66 </span>                <span class="ID">style</span><span class="Operator">=</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">TE_READONLY</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  67 </span></span>
<span class="line"><span class="LineNumber">  68 </span>    <span class="ResWord">def</span> <span class="ID">OnUpdate</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">model</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#3 设置文本域</span></span>
<span class="line"><span class="LineNumber">  69 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">textFields</span><span class="Operator">[</span><span class="String">"First Name"</span><span class="Operator">]</span><span class="Operator">.</span><span class="ID">SetValue</span><span class="Operator">(</span><span class="ID">model</span><span class="Operator">.</span><span
class="ID">first</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  70 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">textFields</span><span class="Operator">[</span><span class="String">"Last Name"</span><span class="Operator">]</span><span class="Operator">.</span><span class="ID">SetValue</span><span class="Operator">(</span><span class="ID">model</span><span class="Operator">.</span><span
class="ID">last</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  71 </span>    <span class="Comment">#-------------------------------------------</span></span>
<span class="line"><span class="LineNumber">  72 </span><span class="Comment"/>    <span class="Comment">#4 响应按钮敲击的处理器</span></span>
<span class="line"><span class="LineNumber">  73 </span><span class="Comment"/>    <span class="ResWord">def</span> <span class="ID">OnFred</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  74 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">model</span><span class="Operator">.</span><span class="ID">set</span><span class="Operator">(</span><span class="String">"Fred"</span><span class="Operator">,</span> <span class="String">"Flintstone"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  75 </span></span>
<span class="line"><span class="LineNumber">  76 </span>    <span class="ResWord">def</span> <span class="ID">OnBarney</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  77 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">model</span><span class="Operator">.</span><span class="ID">set</span><span class="Operator">(</span><span class="String">"Barney"</span><span class="Operator">,</span> <span class="String">"Rubble"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  78 </span></span>
<span class="line"><span class="LineNumber">  79 </span>    <span class="ResWord">def</span> <span class="ID">OnWilma</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  80 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">model</span><span class="Operator">.</span><span class="ID">set</span><span class="Operator">(</span><span class="String">"Wilma"</span><span class="Operator">,</span> <span class="String">"Flintstone"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  81 </span></span>
<span class="line"><span class="LineNumber">  82 </span>    <span class="ResWord">def</span> <span class="ID">OnBetty</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  83 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">model</span><span class="Operator">.</span><span class="ID">set</span><span class="Operator">(</span><span class="String">"Betty"</span><span class="Operator">,</span> <span class="String">"Rubble"</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  84 </span>    <span class="Comment">#---------------------------------------------</span></span>
<span class="line"><span class="LineNumber">  85 </span><span class="Comment"/>    <span class="ResWord">def</span> <span class="ID">OnCloseWindow</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">event</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  86 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">Destroy</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  87 </span></span>
<span class="line"><span class="LineNumber">  88 </span><span class="ResWord">if</span> <span class="ID">__name__</span> <span class="Operator">==</span> <span class="String">'__main__'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  89 </span>    <span class="ID">app</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">PySimpleApp</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  90 </span>    <span class="ID">frame</span> <span class="Operator">=</span> <span class="ID">ModelExample</span><span class="Operator">(</span><span class="ID">parent</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">,</span> <span class="ID">id</span><span class="Operator">=</span><span class="Operator">-</span><span class="Number">1</span><span
class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  91 </span>    <span class="ID">frame</span><span class="Operator">.</span><span class="ID">Show</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  92 </span>    <span class="ID">app</span><span class="Operator">.</span><span class="ID">MainLoop</span><span class="Operator">(</span><span class="Operator">)</span><span class="Text"/></span>
</pre></div><span id="line-844" class="anchor"/><p class="line874">说明： <span id="line-845" class="anchor"/><span id="line-846" class="anchor"/><span id="line-847" class="anchor"/></p><p class="line867"><strong>#1</strong>：这行执行更新 <span id="line-848" class="anchor"/><span id="line-849" class="anchor"/></p><p
class="line867"><strong>#2</strong>：这两行创建这个模型对象，并且把<tt>OnUpdate()</tt>方法注册为一个<tt>listener</tt>。现在当更新被调用时，<tt>OnUpdate()</tt>方法将被调用。 <span id="line-850" class="anchor"/><span id="line-851" class="anchor"/></p><p
class="line867"><strong>#3</strong>：<tt>OnUpdate()</tt>方法本身简单地使用模型更新后的值来设置文本域中的值。该方法的代码中可以使用<tt>self.model</tt>这个实例来代替<tt>model</tt>（它们是同一个对象）。使用方法作为参数，代码是更健壮的，在这种情况下，同样的代码可以监听多个对象。 <span id="line-852" class="anchor"/><span id="line-853" class="anchor"/></p><p
class="line867"><strong>#4</strong>：按钮敲击的处理器改变模型对象的值，它触发更新。 <span id="line-854" class="anchor"/><span id="line-855" class="anchor"/></p><p
class="line862">在这样一个小的例子中，使用模型更新机制似乎有点大才小用了。为什么按钮处理器不能直接设置文本域的值呢。然而，当这个模型类存在一个更复杂的内部状况和处理时，这个模型机制就变得更有价值了。例如，你将能够将内部的分配从一个<tt>Python</tt>字典改变为一个外部的数据库，而不在视图中做任何改变。 <span id="line-856"
class="anchor"/>假如你正在处理一个已有的类，而不能或不愿对其做改变，那么<tt>AbstractModel</tt>可以用作该类的代理，方法与例5.10中的阵容所用的方法大致相同。 <span id="line-857" class="anchor"/><span id="line-858" class="anchor"/></p><p
class="line862">另外，<tt>wxPython</tt>包含两个单独的类似<tt>MVC</tt>更新机制的实现，它们比我们这里说明的这个有更多的特性。第一个是模块<tt>wx.lib.pubsub</tt>，它在结构上与我们先前给出的类<tt>AbstractModel</tt>十分相似。名为<tt>Publisher</tt>的模型类使得对象能够监听仅特定类型的消息。另一个更新系统是<tt>wx.lib.evtmgr.eventManager</tt>，它建立在 <span id="line-859"
class="anchor"/><tt>pubsub</tt>之上，并且有一些额外的特性，包括一个更精心的面向对象的设计和事件关联的连接或去除的易用性。 <span id="line-860" class="anchor"/><span id="line-861" class="anchor"/><span id="line-862" class="anchor"/><span id="line-863" class="anchor"/></p><p class="line867">
</p><h2 id="head-594c3400ef2de24c1b92f431d71fec45b2b196a8">1.3. 如何对一个GUI程序进行单元测试？</h2>
<span id="line-864" class="anchor"/><span id="line-865" class="anchor"/><span id="line-866" class="anchor"/><p
class="line862">好的重构和<tt>MVC</tt>设计模式的一个主要的好处是，它使得使用“单元测试”来验证你程序的性能更容易了。单元测试是对你的程序的单个的特定功能的测试。由于重构和<tt>MVC</tt>设计模式两者的使用，使得你的程序被分成了小的块，因此你更容易针对你程序的个别的部分写特定的单元测试。当重构的时候，结合使用单元测试是特别有用的，因为完整的单元测试使得在你移动你的代码后，你能够检验你是否引入了任何错误。 <span id="line-867"
class="anchor"/><span id="line-868" class="anchor"/></p><p class="line862">接下来的难题是在单元测试中如何测试<tt>UI</tt>代码。测试一个模型是相对简单的，因为模型的大部分功能不依赖于用户的输入。测试界面本身的功能比较困难，因为界面的行为依赖于用户的行为，而用户的行为又是难以封装在内的。在这一节，我们将给你展示如何在<tt>wxPython</tt>中使用单元测试。尤其是在单元测试期间手工产生事件去触发行为的用法。 <span id="line-869"
class="anchor"/><span id="line-870" class="anchor"/><span id="line-871" class="anchor"/></p><p class="line867">
</p><h3 id="head-8c0e644016692f5a9c2d62b234f89f44b7d9d66e">1.3.1. unittest模块</h3>
<span id="line-872" class="anchor"/><span id="line-873" class="anchor"/><span id="line-874" class="anchor"/><p
class="line862">当写用户测试的时候，使用已有的测试引擎来节省减少重复的写代码的运行你的测试是有帮助的。自2.1版以来，<tt>Python</tt>已发布了<tt>unittest</tt>模块。<tt>unittest</tt>模块使用一名为<tt>PyUnit</tt>的测试框架（参见<tt>http:</tt>//<tt>pyunit.sourceforge.net</tt>/）。<tt>PyUnit</tt>模块由<tt>Test</tt>,<tt>TestCase</tt>,<tt>TestSuite</tt>组成。下表5.5说明了这三个组成。 <span id="line-875" class="anchor"/><span
id="line-876" class="anchor"/><span id="line-877" class="anchor"/></p><p class="line867"><strong>表5.5</strong> <span id="line-878" class="anchor"/><span id="line-879" class="anchor"/></p><p class="line867"><tt>Test</tt>：被<tt>PyUnit</tt>引擎调用的一个单独的方法。根据约定，一个测试方法的名字以<tt>test</tt>开头。测试方法通常执行一些代码，然后执行一个或多个断定语句来测试结果是否是预期的。 <span id="line-880"
class="anchor"/><span id="line-881" class="anchor"/></p><p class="line867"><tt>TestCase</tt>：一个类，它定义了一个或多个单独的测试，这些测试共享一个公共的配置。这个类定义在<tt>PyUnit</tt>中以管理一组这样的测试。<tt>TestCase</tt>在测试前后对每个测试都提供了公共配置支持，确保每个测试分别运行。<tt>TestCase</tt>也定义了一些专门的断定方法，如<tt>assertEqual</tt>。 <span id="line-882" class="anchor"/><span id="line-883"
class="anchor"/></p><p class="line867"><tt>TestSuite</tt>：为了同时被执行而组合在一起的一个或多个<tt>test</tt>方法或<tt>TestCase</tt>对象。当你告诉<tt>PyUnit</tt>去执行测试时，你传递给它一个<tt>TestSuite</tt>对象去执行。 <span id="line-884" class="anchor"/><span id="line-885" class="anchor"/></p><p class="line862">单个的<tt>PyUnit</tt>测试可能有三种结果：<tt>success</tt>（成功）, <tt>failure</tt>（失败）,
或<tt>error</tt>（错误）。<tt>success</tt>表明测试完成，所有的断定都为真（通过），并且没有引发错误。也就是说得到了我们所希望的结果。<tt>Failure</tt>和<tt>error</tt>表明代码存在问题。<tt>failure</tt>意味着你的断定之一返回<tt>false</tt>，表明代码执行成功了，但是没有做你预期的事。<tt>error</tt>意味着测试执行到某处，触发了一个<tt>Python</tt>异常，表明你的代码没有运行成功。在单个的测试中，<tt>failure</tt>或<tt>error</tt>一出现，整个测试就终止了，即使在代码中还有多个断定要测试，然后测试的执行将移到到下一个单个的测试。
<span id="line-886" class="anchor"/><span id="line-887" class="anchor"/><span id="line-888" class="anchor"/></p><p class="line867">
</p><h3 id="head-9864f0790accbfd523b31c462c230146512f020f">1.3.2. 一个unittest范例</h3>
<span id="line-889" class="anchor"/><span id="line-890" class="anchor"/><span id="line-891" class="anchor"/><p class="line862">下例5.13展示了一个使用<tt>unittest</tt>模块的范例，其中对例5.12中的模型例子进行测试。 <span id="line-892" class="anchor"/><span id="line-893" class="anchor"/></p><p class="line874">例5.13 对模型例子进行单元测试的一个范例 <span id="line-894" class="anchor"/><span id="line-895" class="anchor"/><span
id="line-896" class="anchor"/><span id="line-897" class="anchor"/><span id="line-898" class="anchor"/><span id="line-899" class="anchor"/><span id="line-900" class="anchor"/><span id="line-901" class="anchor"/><span id="line-902" class="anchor"/><span id="line-903" class="anchor"/><span id="line-904" class="anchor"/><span id="line-905" class="anchor"/><span id="line-906" class="anchor"/><span id="line-907" class="anchor"/><span
id="line-908" class="anchor"/><span id="line-909" class="anchor"/><span id="line-910" class="anchor"/><span id="line-911" class="anchor"/><span id="line-912" class="anchor"/><span id="line-913" class="anchor"/><span id="line-914" class="anchor"/><span id="line-915" class="anchor"/><span id="line-916" class="anchor"/><span id="line-917" class="anchor"/><span id="line-918" class="anchor"/><span id="line-919" class="anchor"/><span
id="line-920" class="anchor"/><span id="line-921" class="anchor"/><span id="line-922" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-eb704779193b61bec161530bb2a2b96acb2139b6_012\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-eb704779193b61bec161530bb2a2b96acb2139b6_012', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-eb704779193b61bec161530bb2a2b96acb2139b6_012" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">import</span> <span class="ID">unittest</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="ResWord">import</span> <span class="ID">modelExample</span></span>
<span class="line"><span class="LineNumber">   3 </span><span class="ResWord">import</span> <span class="ID">wx</span></span>
<span class="line"><span class="LineNumber">   4 </span></span>
<span class="line"><span class="LineNumber">   5 </span><span class="ResWord">class</span> <span class="ID">TestExample</span><span class="Operator">(</span><span class="ID">unittest</span><span class="Operator">.</span><span class="ID">TestCase</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#1 声明一个TestCase</span></span>
<span class="line"><span class="LineNumber">   6 </span></span>
<span class="line"><span class="LineNumber">   7 </span>    <span class="ResWord">def</span> <span class="ID">setUp</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#2 为每个测试所做的配置</span></span>
<span class="line"><span class="LineNumber">   8 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">app</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">PySimpleApp</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">frame</span> <span class="Operator">=</span> <span class="ID">modelExample</span><span class="Operator">.</span><span class="ID">ModelExample</span><span class="Operator">(</span><span class="ID">parent</span><span class="Operator">=</span><span class="ID">None</span><span
class="Operator">,</span> <span class="ID">id</span><span class="Operator">=</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  10 </span></span>
<span class="line"><span class="LineNumber">  11 </span>    <span class="ResWord">def</span> <span class="ID">tearDown</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#3 测试之后的清除工作</span></span>
<span class="line"><span class="LineNumber">  12 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">frame</span><span class="Operator">.</span><span class="ID">Destroy</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  13 </span></span>
<span class="line"><span class="LineNumber">  14 </span>    <span class="ResWord">def</span> <span class="ID">testModel</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#4 声明一个测试(Test)</span></span>
<span class="line"><span class="LineNumber">  15 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">frame</span><span class="Operator">.</span><span class="ID">OnBarney</span><span class="Operator">(</span><span class="ID">None</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  16 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">assertEqual</span><span class="Operator">(</span><span class="String">"Barney"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">frame</span><span class="Operator">.</span><span class="ID">model</span><span
class="Operator">.</span><span class="ID">first</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber">  17 </span>                <span class="ID">msg</span><span class="Operator">=</span><span class="String">"First is wrong"</span><span class="Operator">)</span> <span class="Comment">#5 对于可能的失败的断定</span></span>
<span class="line"><span class="LineNumber">  18 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">assertEqual</span><span class="Operator">(</span><span class="String">"Rubble"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">frame</span><span class="Operator">.</span><span class="ID">model</span><span
class="Operator">.</span><span class="ID">last</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  19 </span></span>
<span class="line"><span class="LineNumber">  20 </span></span>
<span class="line"><span class="LineNumber">  21 </span></span>
<span class="line"><span class="LineNumber">  22 </span><span class="ResWord">def</span> <span class="ID">suite</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">:</span> <span class="Comment">#6 创建一个TestSuite</span></span>
<span class="line"><span class="LineNumber">  23 </span>    <span class="ID">suite</span> <span class="Operator">=</span> <span class="ID">unittest</span><span class="Operator">.</span><span class="ID">makeSuite</span><span class="Operator">(</span><span class="ID">TestExample</span><span class="Operator">,</span> <span class="String">'test'</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  24 </span>    <span class="ResWord">return</span> <span class="ID">suite</span></span>
<span class="line"><span class="LineNumber">  25 </span></span>
<span class="line"><span class="LineNumber">  26 </span><span class="ResWord">if</span> <span class="ID">__name__</span> <span class="Operator">==</span> <span class="String">'__main__'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  27 </span>    <span class="ID">unittest</span><span class="Operator">.</span><span class="ID">main</span><span class="Operator">(</span><span class="ID">defaultTest</span><span class="Operator">=</span><span class="String">'suite'</span><span class="Operator">)</span> <span class="Comment">#7 开始测试</span><span class="Text"/></span>
</pre></div><span id="line-923" class="anchor"/><p class="line874">说明： <span id="line-924" class="anchor"/><span id="line-925" class="anchor"/><span id="line-926" class="anchor"/></p><p class="line867"><strong>#1</strong>：声明<tt>unittest.TestCase</tt>的一个子类。为了最好的使每个测试相互独立，测试执行器为每个测试创建该类的一个实例。 <span id="line-927" class="anchor"/><span id="line-928" class="anchor"/><span
id="line-929" class="anchor"/></p><p class="line867"><strong>#2</strong>： <tt>setUp()</tt>方法在每个测试被执行前被调用。这使得你能够保证每个对你的应用程序的测试都处在相同的状态下。这里我们创建了一个用于测试的框架(<tt>frame)</tt>的实例。 <span id="line-930" class="anchor"/><span id="line-931" class="anchor"/><span id="line-932" class="anchor"/></p><p class="line867"><strong>#3</strong>
：<tt>tearDown()</tt>方法在每个测试执行完后被调用。这使得你能够做一些清理工作，以确保从一个测试转到另一个测试时系统状态保持一致。通常这里包括重置全局数据，关闭数据库连接等诸如此类的东东。这里我们对框架调用了<tt>Destroy()</tt>，以强制性地使<tt>wxWidgets</tt>退出，并且为下一个测试保持系统处在一个良好的状态。 <span id="line-933" class="anchor"/><span id="line-934" class="anchor"/><span id="line-935"
class="anchor"/></p><p class="line867"><strong>#4</strong> ：测试方法通常以<tt>test</tt>作为前缀，尽管这处于你的控制之下（看#6）。测试方法不要参数。我们这里的测试方法中，通过调用<tt>OnBarney</tt>事件处理器方法来开始测试行为。 <span id="line-936" class="anchor"/><span id="line-937" class="anchor"/><span id="line-938" class="anchor"/></p><p class="line867"><strong>#5</strong>
：这行使用<tt>assertEqual()</tt>方法来测试模型对象的改变是否正确。<tt>assertEqual()</tt>要两个参数，如果这两个参数不相等，则测试失败。所有的<tt>PyUnit</tt>断定方法都有一个可选的参数<tt>msg</tt>，如果断定失败则显示<tt>msg(msg</tt>的默认值几乎够表达意思了） <span id="line-939" class="anchor"/><span id="line-940" class="anchor"/><span id="line-941" class="anchor"/></p><p class="line867"><strong>#6</strong>：
这个方法通过简单有效的机制创建一组测试。<tt>makeSuite()</tt>方法要求一个<tt>Python</tt>的类的对象和一个字符串前缀作为参数，并返回一组测试（包含该类中所有前缀为参数“前缀”的方法）。还有其它的机制，它们使得可以更明确设置测试组中的内容，但是<tt>makeSuite()</tt>方法通过足够了。我们这里写的<tt>suite()</tt>方法是一个样板模板，它可被用在你的所有测试模块中。 <span id="line-942" class="anchor"/><span id="line-943"
class="anchor"/><span id="line-944" class="anchor"/></p><p class="line867"><strong>#7</strong> ：这行调用了<tt>PyUnit</tt>的基于文本的执行器。参数是一个方法的名字（该方法返回一测试组）。然后<tt>suite</tt>被执行，并且结果被输出到控制台。如果你想使用<tt>GUI</tt>测试执行器，那么这行调用应使用 <span id="line-945" class="anchor"/><tt>unittest.TextTestRunner</tt>的方法而非<tt>unittest.main</tt>。 <span id="line-946"
class="anchor"/><span id="line-947" class="anchor"/></p><p class="line862">在控制台中<tt>PyUnit</tt>测试的结果如下： <span id="line-948" class="anchor"/><span id="line-949" class="anchor"/></p><p class="line874">. <span id="line-950" class="anchor"/></p><hr class="hr6"/><p class="line874"> <span id="line-951" class="anchor"/><tt>Ran</tt> 1 <tt>test</tt> <tt>in</tt> 0.190s <span id="line-952" class="anchor"/><span
id="line-953" class="anchor"/></p><p class="line867"><tt>OK</tt> <span id="line-954" class="anchor"/><span id="line-955" class="anchor"/></p><p class="line862">这是一个成功的测试。第一行的"."号表明测试成功。每个测试都得到一个字符并显示在这行。"."表明成功，"F"表明失败，"E"表明错误。然后是一个简单的列表，其中包含测试的数量、总的测试时间和<tt>OK</tt>，<tt>OK</tt>表明所有测试通过。 <span id="line-956"
class="anchor"/><span id="line-957" class="anchor"/></p><p class="line862">对于一个失败或错误的测试，你将得到一堆跟踪提示（显示了<tt>Python</tt>得到的错误处的情况）。比如，如果你将#5改为<tt>{{{self.assertEqual(</tt>"<tt>Fife</tt>", <tt>self.frame.model.first)</tt>}}}，我们将得到如下结果： <span id="line-958" class="anchor"/><span id="line-959" class="anchor"/></p><pre>F
<span id="line-960" class="anchor"/>======================================================================
<span id="line-961" class="anchor"/>FAIL: testModel (__main__.TestExample)
<span id="line-962" class="anchor"/>----------------------------------------------------------------------
<span id="line-963" class="anchor"/>Traceback (most recent call last):
<span id="line-964" class="anchor"/>File "C:\wxPyBook\book\1\Blueprint\testExample.py", line 18, in testModel
<span id="line-965" class="anchor"/>self.assertEqual("Fife", self.frame.model.last)
<span id="line-966" class="anchor"/>File "c:\python23\lib\unittest.py", line 302, in failUnlessEqual
<span id="line-967" class="anchor"/>raise self.failureException, \
<span id="line-968" class="anchor"/>AssertionError: 'Fife' != 'Rubble'
<span id="line-969" class="anchor"/>
<span id="line-970" class="anchor"/>----------------------------------------------------------------------
<span id="line-971" class="anchor"/>Ran 1 test in 0.070s
<span id="line-972" class="anchor"/>
<span id="line-973" class="anchor"/>FAILED (failures=1)
<span id="line-974" class="anchor"/></pre><span id="line-975" class="anchor"/><p class="line862">"F"表明了失败，“<tt>testModel</tt>”是产生失败的方法名，下面的跟踪显示出18号上的断定失败，以及失败的原因。你一般需要根据这些去找到产生失败的实际位置。 <span id="line-976" class="anchor"/><span id="line-977" class="anchor"/><span id="line-978" class="anchor"/></p><p class="line867">
</p><h3 id="head-23e13dd0eae64e87845ec9c55b10c3a5c2369726">1.3.3. 测试用户事件</h3>
<span id="line-979" class="anchor"/><span id="line-980" class="anchor"/><span id="line-981" class="anchor"/><p class="line862">当然，上面的测试还不完整。我们还可以对框架中的<tt>TextField</tt>在模型更新后，其中值的更新情况进行测试。这个测试是很简单的。另一个你可能想要做的测试是，自动生成按钮敲击事件，以及确保正确的处理器被调用。这个测试有点难度。下例5.14展示了一个例子： <span id="line-982" class="anchor"/><span
id="line-983" class="anchor"/></p><p class="line874">例5.14 生成一个用户事件的测试 <span id="line-984" class="anchor"/><span id="line-985" class="anchor"/><span id="line-986" class="anchor"/><span id="line-987" class="anchor"/><span id="line-988" class="anchor"/><span id="line-989" class="anchor"/><span id="line-990" class="anchor"/><span id="line-991" class="anchor"/><span id="line-992" class="anchor"/><span
id="line-993" class="anchor"/><span id="line-994" class="anchor"/><span id="line-995" class="anchor"/></p><div lang="en" dir="ltr" class="codearea">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-db216eb3cabdb52048458e6e51e56a1f5dd4a1ab_013\', 1, 1);" \
class="codenumbers">切换行号显示<\/a>');
</script><a class="codenumbers" onclick="return togglenumber('CA-db216eb3cabdb52048458e6e51e56a1f5dd4a1ab_013', 1, 1);" href="#">切换行号显示</a>
<pre lang="en" id="CA-db216eb3cabdb52048458e6e51e56a1f5dd4a1ab_013" dir="ltr"><span class="line"><span class="LineNumber">   1 </span><span class="ResWord">def</span> <span class="ID">testEvent</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="ID">panel</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">frame</span><span class="Operator">.</span><span class="ID">GetChildren</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">[</span><span class="Number">0</span><span
class="Operator">]</span></span>
<span class="line"><span class="LineNumber">   3 </span>        <span class="ResWord">for</span> <span class="ID">each</span> <span class="ResWord">in</span> <span class="ID">panel</span><span class="Operator">.</span><span class="ID">GetChildren</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   4 </span>                <span class="ResWord">if</span> <span class="ID">each</span><span class="Operator">.</span><span class="ID">GetLabel</span><span class="Operator">(</span><span class="Operator">)</span> <span class="Operator">==</span> <span class="String">"Wilmafy"</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">   5 </span>                        <span class="ID">wilma</span> <span class="Operator">=</span> <span class="ID">each</span></span>
<span class="line"><span class="LineNumber">   6 </span>                        <span class="ResWord">break</span></span>
<span class="line"><span class="LineNumber">   7 </span>        <span class="ID">event</span> <span class="Operator">=</span> <span class="ID">wx</span><span class="Operator">.</span><span class="ID">CommandEvent</span><span class="Operator">(</span><span class="ID">wx</span><span class="Operator">.</span><span class="ID">wxEVT_COMMAND_BUTTON_CLICKED</span><span class="Operator">,</span>  <span
class="ID">wilma</span><span class="Operator">.</span><span class="ID">GetId</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   8 </span>        <span class="ID">wilma</span><span class="Operator">.</span><span class="ID">GetEventHandler</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">ProcessEvent</span><span class="Operator">(</span><span class="ID">event</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">   9 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">assertEqual</span><span class="Operator">(</span><span class="String">"Wilma"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">frame</span><span class="Operator">.</span><span
class="ID">model</span><span class="Operator">.</span><span class="ID">first</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  10 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">assertEqual</span><span class="Operator">(</span><span class="String">"Flintstone"</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">frame</span><span class="Operator">.</span><span
class="ID">model</span><span class="Operator">.</span><span class="ID">last</span><span class="Operator">)</span><span class="Text"/></span>
</pre></div><span id="line-996" class="anchor"/><span id="line-997" class="anchor"/><p
class="line862">本例开始的几行寻找一个适当的按钮（这里是"<tt>Wilmafy</tt>"按钮）。由于我们没有显式地把这些按钮存储到变量中，所以我们就需要遍历<tt>panel</tt>的孩子列表，直到我们找到正确的按钮。接下来的两行创建用以被按钮发送的<tt>wx.CommandEvent</tt>事件，并发送出去。参数<tt>wx.wxEVT_COMMAND_BUTTON_CLICKED</tt>是一个常量，它表示一个事件类型，是个整数值，它被绑定到<tt>EVT_BUTTON</tt>事件绑定器对象。（你能够在<tt>wx.py</tt>文件中发现这个整数常量）。<tt>wilma.GetId()</tt>的作用是设置产生该事件的按钮<tt>ID</tt>。至此，该事件已具有了实际<tt>wxPython</tt>事件的所有相关特性。然后我们调用<tt>ProcessEvent()</tt>来将该事件发送到系统中。如果代码按照计划工作的话，那么模型的<tt>first</tt>和<tt>last</tt>中的名字将被改变为“<tt>Wilma</tt>”
和 “<tt>Flintstone</tt>”。 <span id="line-998" class="anchor"/><span id="line-999" class="anchor"/></p><p
class="line862">通过生成事件，你能够从头到尾地测试你的系统的响应性。理论上，你可以生成一个鼠标按下和释放事件以确保响应按钮敲击的按钮敲击事件被创建。但是实际上，这不会工作，因为低级的<tt>wx.Events</tt>没有被转化为本地系统事件并发送到本地窗口部件。然而，当测试自定义的窗口部件时，可以用到类似于第三章中两个按钮控件的处理。此类单元测试，对于你的应用程序的响应性可以给你带来信心。 <span id="line-1000"
class="anchor"/><span id="line-1001" class="anchor"/><span id="line-1002" class="anchor"/></p><p class="line867">
</p><h2 id="head-fef54ea4ec3bb8cc7561153dc840d2dcc54e588a">1.4. 本章小结</h2>
<span id="line-1003" class="anchor"/><span id="line-1004" class="anchor"/><span id="line-1005" class="anchor"/><p class="line862">1、众所周知，<tt>GUI</tt>代码看起来很乱且难于维护。这一点可以通过一点努力来解决，当代码以后要变动时，我们所付出的努力是值得的。 <span id="line-1006" class="anchor"/><span id="line-1007" class="anchor"/></p><p
class="line874">2、重构是对现存代码的改进。重构的目的有：避免重复、去掉无法理解的字面值、创建短的方法（只做一件事情）。为了这些目标不断努力将使你的代码更容易去读和理解。另外，好的重构也几乎避免了某类错误的发生（如剪切和粘贴导致的错误）。 <span id="line-1008" class="anchor"/><span id="line-1009" class="anchor"/></p><p
class="line862">3、把你的数据从代码中分离出来，使得数据和代码更易协同工作。管理这种分离的标准机制是<tt>MVC</tt>机制。用<tt>wxPython</tt>的术语来说，<tt>V(View)</tt>是<tt>wx.Window</tt>对象，它显示你的数据；<tt>C(Controller)</tt>是<tt>wx.EvtHandler</tt>对象，它分派事件；<tt>M(Model)</tt>是你自己的代码，它包含被显示的信息。 <span id="line-1010" class="anchor"/><span id="line-1011"
class="anchor"/></p><p class="line862">4、或许<tt>MVC</tt>结构的最清晰的例子是<tt>wxPython</tt>的核心类中的<tt>wx.grid.PyGridTableBase</tt>，它被用于表示数据以在一个<tt>wx.grid.Grid</tt>控件中显示。表中的数据可以来自于该类本身，或该类可以引用另一个包含相关数据的对象。 <span id="line-1012" class="anchor"/><span id="line-1013" class="anchor"/></p><p
class="line862">5、你可以使用一个简单的机制来创建你自己的<tt>MVC</tt>设置，以便在模型被更新时通知视图(<tt>view)</tt>。在<tt>wxPython</tt>中也有现成的模块可以帮助你做这样的事情。 <span id="line-1014" class="anchor"/><span id="line-1015" class="anchor"/></p><p
class="line862">6、单元测试是检查你的程序的正确性的一个好的方法。在<tt>Python</tt>中，<tt>unittest</tt>模块是执行单元测试的标准方法中的一种。使一些包，对一个<tt>GUI</tt>进行单元测试有点困难，但是<tt>wxPython</tt>的可程序化的创建事件使得这相对容易些了。这使得你能够从头到尾地去测试你的应用程序的事件处理行为。 <span id="line-1016" class="anchor"/><span id="line-1017" class="anchor"/></p><p
class="line862">在下一章中，我们将给你展示如何去建造一个小型的应用程序以及如何去做一些事情，这些对你将建造的<tt>wxPython</tt>应用程序将是通用的。 <span id="line-1018" class="anchor"/><span id="bottom" class="anchor"/></p></div>
