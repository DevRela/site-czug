---
created: 2006-11-23 11:48:38
creator: eishn
description: 无聊, 写了个动态加载 CSS 文件的脚本。至于有什么用处, 以后再说。
title: 在网页中动态加载 CSS 样式文件
---
<p>/**<br /> * dynamic-style.js<br /> * 作者: 我<br /> * 时间: 2006 年 11 月 26 日<br /> */<br />( function() {<br />var drv = {}; window.Driver = drv;<br /><br />if(document.all) { // For IE<br />    drv.XMLHttpRequest = function() {<br />        var xmlhttp = null;<br />        /*@cc_on @*/<br />        /*@if (@_jscript_version &gt;= 5)<br />        try    { xmlhttp = new ActiveXObject("Msxml2.XMLHTTP"); }<br />        catch (e) {<br />            try    { xmlhttp = new ActiveXObject("Microsoft.XMLHTTP"); }<br />            catch (E) { xmlhttp = false; } }<br />            @end @*/<br />        return xmlhttp;<br />    };<br /><br />    window.DynamicStyle = function(s) {<br />        var uid = __push__(s);<br />        document.createStyleSheet('"' + uid + '");');<br />    };<br /><br />    window.__tmp__ = {};<br />    window.__push__ = function(s) {<br />        var uid = "_" + Math.ceil(Math.random() * 16777216) + "_" + (new Date()).getTime();<br />        window.__tmp__[uid] = s;<br />        return uid;<br />    };<br />    window.__pop__ = function(uid) {<br />        var s = window.__tmp__[uid];<br />        window.__tmp__[uid] = undefined;<br />        return s<br />    };<br /><br />} else { // For Gecko<br />    drv.XMLHttpRequest = function() {<br />        return xmlhttp = new XMLHttpRequest();<br />    };<br /><br />    window.DynamicStyle = function(s) {<br />        var d = document.createElement('STYLE'); d.type = 'text/css';<br />        document.body.appendChild(d);<br />        d.innerHTML = s;<br />    };<br />} // Driver End<br /><br />window.LazyLoadStyle = function(url) {<br />    var xh = Driver.XMLHttpRequest();<br />    xh.onreadystatechange = function() {<br />        if(xh.readyState == 4) {<br />            if(xh.status == 200) {<br />                DynamicStyle(xh.responseText);<br />            } else {<br />                alert('糟糕, 下载失败!');<br />            }<br />        }<br />    };<br />    xh.open('GET', url, true); xh.send(null);<br />};<br /><br />} )();<br /><br /><br /><br /><a href="http://www.mmommo.com/?id=69">参考资料: 动态创建 Style 节点 (mmommo's blog)</a></p>